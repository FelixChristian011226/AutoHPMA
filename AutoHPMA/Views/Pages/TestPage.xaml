<Page
    x:Class="AutoHPMA.Views.Pages.TestPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:AutoHPMA.Views.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:pages="clr-namespace:AutoHPMA.ViewModels.Pages"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="TestPage"
    d:DataContext="{d:DesignInstance Type=pages:TestViewModel}"
    d:DesignHeight="450"
    d:DesignWidth="800"
    ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
    ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    mc:Ignorable="d">

    <StackPanel Margin="40,30,40,10" Cursor="">
        <Border
            Padding="16"
            Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
            BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
            BorderThickness="1,1,1,0"
            CornerRadius="8,8,8,8">
            <TabControl Margin="0 0 0 0" TabStripPlacement="Top">
                <!--  截屏测试  -->
                <TabItem IsSelected="True" MaxWidth="100">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Margin="0,0,6,0" Symbol="ScanCamera24" />
                            <TextBlock Text="截屏测试" FontWeight="Bold" />
                        </StackPanel>
                    </TabItem.Header>
                    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="0,10,10,10">
                        <StackPanel>
                            <!-- 截屏配置卡片 -->
                            <Border 
                                Margin="0,8,0,0" 
                                Padding="16"
                                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="6">
                                <StackPanel>
                                    <!-- 标题 -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                        <ui:SymbolIcon Margin="0,0,8,0" Symbol="Settings24" FontSize="16"/>
                                        <ui:TextBlock FontTypography="BodyStrong" Text="截屏配置" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    
                                    <!-- 截屏方式选择 -->
                                    <Grid Margin="0,0,0,12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <ui:TextBlock FontTypography="Body" Text="截屏方式" />
                                            <ui:TextBlock 
                                                Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                                Text="选择截屏 API，不同 API 对窗口捕获的兼容性不同"
                                                FontSize="12" />
                                        </StackPanel>
                                        <ComboBox
                                            Grid.Column="1"
                                            Width="200"
                                            VerticalAlignment="Center"
                                            ItemsSource="{Binding ViewModel.CaptureMethods}"
                                            SelectedItem="{Binding ViewModel.SelectedCaptureMethod, Mode=TwoWay}" />
                                    </Grid>
                                    
                                    <Separator Margin="-16,0" Opacity="0.3"/>
                                    
                                    <!-- 窗口选择 -->
                                    <Grid Margin="0,12,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <ui:TextBlock FontTypography="Body" Text="目标窗口" />
                                            <ui:TextBlock 
                                                Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                                Text="选择要进行截屏测试的目标窗口"
                                                FontSize="12" />
                                        </StackPanel>
                                        <ComboBox
                                            Grid.Column="1"
                                            Width="280"
                                            Margin="0,0,8,0"
                                            VerticalAlignment="Center"
                                            ItemsSource="{Binding ViewModel.AvailableWindows}"
                                            SelectedItem="{Binding ViewModel.SelectedWindow, Mode=TwoWay}"
                                            DisplayMemberPath="DisplayName" />
                                        <ui:Button
                                            Grid.Column="2"
                                            VerticalAlignment="Center"
                                            Command="{Binding ViewModel.RefreshWindowListCommand}"
                                            ToolTip="刷新窗口列表"
                                            Icon="{ui:SymbolIcon ArrowSync24}" />
                                    </Grid>
                                </StackPanel>
                            </Border>
                            
                            <!-- 操作按钮卡片 -->
                            <Border 
                                Margin="0,12,0,0" 
                                Padding="16"
                                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="6">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                        <ui:TextBlock FontTypography="Body" Text="实时预览" />
                                        <ui:TextBlock 
                                            Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                            Text="开启实时截屏预览窗口，测试截屏效果和性能"
                                            FontSize="12" />
                                    </StackPanel>
                                    <ui:Button
                                        Grid.Column="1"
                                        Appearance="Primary"
                                        Command="{Binding ViewModel.ScreenshotTestCommand}"
                                        Icon="{ui:SymbolIcon Play24}">
                                        <ui:Button.Content>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="开始预览" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </ui:Button.Content>
                                    </ui:Button>
                                </Grid>
                            </Border>
                            
                            <!-- 使用说明提示 -->
                            <Border 
                                Margin="0,16,0,0" 
                                Padding="12"
                                Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                                CornerRadius="6"
                                BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}"
                                BorderThickness="1">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                        <ui:SymbolIcon Symbol="Info24" Margin="0,0,8,0" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                        <ui:TextBlock FontTypography="BodyStrong" Text="使用提示" />
                                    </StackPanel>
                                    <ui:TextBlock 
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="1. 选择合适的截屏方式，推荐使用 BitBlt 或 Windows Graphics Capture 方式" />
                                    <ui:TextBlock 
                                        Margin="0,4,0,0"
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="2. 从窗口列表中选择目标游戏窗口，若未显示请点击刷新按钮" />
                                    <ui:TextBlock 
                                        Margin="0,4,0,0"
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="3. 点击开始预览按钮查看实时截屏效果，验证截图质量和帧率" />
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>
                <!--  鼠标模拟  -->
                <TabItem MaxWidth="100">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Margin="0,0,6,0" Symbol="TapSingle24" />
                            <TextBlock Text="鼠标模拟" FontWeight="Bold" />
                        </StackPanel>
                    </TabItem.Header>
                    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="0,10,10,10">
                        <StackPanel>
                            <!-- 窗口配置卡片 -->
                            <Border 
                                Margin="0,8,0,0" 
                                Padding="16"
                                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="8">
                                <StackPanel>
                                    <!-- 标题 -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                        <ui:SymbolIcon Margin="0,0,8,0" Symbol="Window24" FontSize="16" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                        <ui:TextBlock FontTypography="BodyStrong" Text="窗口配置" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    
                                    <!-- 窗口选择 -->
                                    <Grid Margin="0,0,0,12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <ui:TextBlock FontTypography="Body" Text="目标窗口" />
                                            <ui:TextBlock 
                                                Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                                Text="选择要进行鼠标操作的目标窗口"
                                                FontSize="12" />
                                        </StackPanel>
                                        <ComboBox
                                            Grid.Column="1"
                                            Width="260"
                                            Margin="0,0,8,0"
                                            VerticalAlignment="Center"
                                            ItemsSource="{Binding ViewModel.AvailableWindows}"
                                            SelectedItem="{Binding ViewModel.SelectedClickWindow, Mode=TwoWay}"
                                            DisplayMemberPath="DisplayName" />
                                        <ui:Button
                                            Grid.Column="2"
                                            VerticalAlignment="Center"
                                            Command="{Binding ViewModel.RefreshWindowListCommand}"
                                            ToolTip="刷新窗口列表"
                                            Icon="{ui:SymbolIcon ArrowSync24}" />
                                    </Grid>
                                    
                                    <!-- 子窗口选择（条件显示） -->
                                    <Grid Margin="0,0,0,0"
                                          Visibility="{Binding ViewModel.HasChildWindows, Converter={StaticResource BoolToVisibilityConverter}}">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <ui:TextBlock FontTypography="Body" Text="子窗口（可选）" />
                                            <ui:TextBlock 
                                                Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                                Text="若父窗口无法交互，可选择子窗口进行操作"
                                                FontSize="12" />
                                        </StackPanel>
                                        <ComboBox
                                            Grid.Column="1"
                                            Width="260"
                                            Margin="0,0,40,0"
                                            VerticalAlignment="Center"
                                            ItemsSource="{Binding ViewModel.AvailableChildWindows}"
                                            SelectedItem="{Binding ViewModel.SelectedClickChildWindow, Mode=TwoWay}"
                                            DisplayMemberPath="DisplayName" />
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- 操作列表卡片 -->
                            <Border 
                                Margin="0,12,0,0" 
                                Padding="16"
                                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="8">
                                <StackPanel>
                                    <!-- 标题与工具栏 -->
                                    <Grid Margin="0,0,0,12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <StackPanel Grid.Column="0" Orientation="Horizontal">
                                            <ui:SymbolIcon Margin="0,0,8,0" Symbol="List24" FontSize="16" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                            <ui:TextBlock FontTypography="BodyStrong" Text="操作列表" VerticalAlignment="Center"/>
                                        </StackPanel>
                                        
                                        <StackPanel Grid.Column="2" Orientation="Horizontal">
                                            <ui:Button 
                                                Command="{Binding ViewModel.ImportActionsCommand}"
                                                ToolTip="导入操作列表"
                                                Margin="0,0,4,0"
                                                Padding="8,6">
                                                <StackPanel Orientation="Horizontal">
                                                    <ui:SymbolIcon Symbol="ArrowDownload24" FontSize="14"/>
                                                    <TextBlock Text="导入" Margin="4,0,0,0" FontSize="12"/>
                                                </StackPanel>
                                            </ui:Button>
                                            <ui:Button 
                                                Command="{Binding ViewModel.ExportActionsCommand}"
                                                ToolTip="导出操作列表"
                                                Margin="0,0,4,0"
                                                Padding="8,6">
                                                <StackPanel Orientation="Horizontal">
                                                    <ui:SymbolIcon Symbol="ArrowUpload24" FontSize="14"/>
                                                    <TextBlock Text="导出" Margin="4,0,0,0" FontSize="12"/>
                                                </StackPanel>
                                            </ui:Button>
                                            <ui:Button 
                                                Command="{Binding ViewModel.ClearAllActionsCommand}"
                                                ToolTip="清空所有操作"
                                                Appearance="Secondary"
                                                Padding="8,6">
                                                <StackPanel Orientation="Horizontal">
                                                    <ui:SymbolIcon Symbol="Delete24" FontSize="14"/>
                                                    <TextBlock Text="清空" Margin="4,0,0,0" FontSize="12"/>
                                                </StackPanel>
                                            </ui:Button>
                                        </StackPanel>
                                    </Grid>
                                    
                                    <!-- 添加操作按钮组 -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                        <ui:Button 
                                            Command="{Binding ViewModel.AddClickActionCommand}"
                                            Margin="0,0,8,0"
                                            Padding="12,8"
                                            Background="#1F3B82F6">
                                            <StackPanel Orientation="Horizontal">
                                                <ui:SymbolIcon Symbol="CursorClick24" FontSize="14"/>
                                                <TextBlock Text="+ 点击" Margin="6,0,0,0"/>
                                            </StackPanel>
                                        </ui:Button>
                                        <ui:Button 
                                            Command="{Binding ViewModel.AddDragActionCommand}"
                                            Margin="0,0,8,0"
                                            Padding="12,8"
                                            Background="#1F22C55E">
                                            <StackPanel Orientation="Horizontal">
                                                <ui:SymbolIcon Symbol="HandDraw24" FontSize="14"/>
                                                <TextBlock Text="+ 拖拽" Margin="6,0,0,0"/>
                                            </StackPanel>
                                        </ui:Button>
                                        <ui:Button 
                                            Command="{Binding ViewModel.AddLongPressActionCommand}"
                                            Padding="12,8"
                                            Background="#1FF97316">
                                            <StackPanel Orientation="Horizontal">
                                                <ui:SymbolIcon Symbol="Timer24" FontSize="14"/>
                                                <TextBlock Text="+ 长按" Margin="6,0,0,0"/>
                                            </StackPanel>
                                        </ui:Button>
                                    </StackPanel>
                                    
                                    <!-- 操作列表 DataGrid -->
                                    <DataGrid
                                        x:Name="MouseActionsGrid"
                                        ItemsSource="{Binding ViewModel.MouseActions}"
                                        SelectedItem="{Binding ViewModel.SelectedMouseAction, Mode=TwoWay}"
                                        AutoGenerateColumns="False"
                                        CanUserAddRows="False"
                                        CanUserDeleteRows="False"
                                        CanUserReorderColumns="False"
                                        CanUserSortColumns="False"
                                        Height="200"
                                        GridLinesVisibility="Horizontal"
                                        HeadersVisibility="Column"
                                        BorderThickness="1"
                                        BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                                        IsReadOnly="True"
                                        SelectionMode="Single">
                                        <DataGrid.Columns>
                                            <!-- 类型标签 -->
                                            <DataGridTemplateColumn Header="类型" Width="70" CanUserSort="False">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <Border 
                                                            Background="{Binding ActionType, Converter={StaticResource MouseActionTypeToBackgroundConverter}}"
                                                            CornerRadius="4"
                                                            Padding="6,3"
                                                            HorizontalAlignment="Center">
                                                            <TextBlock 
                                                                Text="{Binding ActionTypeName}"
                                                                FontSize="11"
                                                                FontWeight="Medium"
                                                                Foreground="{Binding ActionType, Converter={StaticResource MouseActionTypeToColorConverter}}"/>
                                                        </Border>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            
                                            <!-- 描述 -->
                                            <DataGridTextColumn Header="描述" Binding="{Binding Description}" Width="120" CanUserSort="False"/>
                                            
                                            <!-- 参数摘要 -->
                                            <DataGridTemplateColumn Header="参数" Width="*" CanUserSort="False">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock 
                                                            Text="{Binding ParameterSummary}"
                                                            FontFamily="Consolas"
                                                            FontSize="12"
                                                            VerticalAlignment="Center"
                                                            Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            
                                            <!-- 操作按钮 -->
                                            <DataGridTemplateColumn Header="操作" Width="100" CanUserSort="False">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                            <ui:Button 
                                                                Command="{Binding DataContext.ViewModel.MoveActionUpCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                                CommandParameter="{Binding}"
                                                                ToolTip="上移"
                                                                Padding="3"
                                                                Margin="0,0,2,0"
                                                                Appearance="Secondary">
                                                                <ui:SymbolIcon Symbol="ChevronUp24" FontSize="11"/>
                                                            </ui:Button>
                                                            <ui:Button 
                                                                Command="{Binding DataContext.ViewModel.MoveActionDownCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                                CommandParameter="{Binding}"
                                                                ToolTip="下移"
                                                                Padding="3"
                                                                Margin="0,0,2,0"
                                                                Appearance="Secondary">
                                                                <ui:SymbolIcon Symbol="ChevronDown24" FontSize="11"/>
                                                            </ui:Button>
                                                            <ui:Button 
                                                                Command="{Binding DataContext.ViewModel.RemoveMouseActionCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                                CommandParameter="{Binding}"
                                                                ToolTip="删除"
                                                                Padding="3"
                                                                Appearance="Danger">
                                                                <ui:SymbolIcon Symbol="Delete24" FontSize="11"/>
                                                            </ui:Button>
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                    
                                    <!-- 参数编辑面板（选中动作时显示） -->
                                    <Border 
                                        Margin="0,12,0,0"
                                        Padding="16"
                                        Background="{ui:ThemeResource CardBackgroundFillColorDefaultBrush}"
                                        CornerRadius="8"
                                        BorderBrush="{ui:ThemeResource CardStrokeColorDefaultBrush}"
                                        BorderThickness="1"
                                        DataContext="{Binding ViewModel.SelectedMouseAction}"
                                        Visibility="{Binding DataContext.ViewModel.SelectedMouseAction, RelativeSource={RelativeSource AncestorType=Page}, 
                                                     Converter={StaticResource NullToVisibilityConverter}}">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="*"/>
                                            </Grid.RowDefinitions>
                                            
                                            <!-- 编辑面板标题栏 -->
                                            <Grid Grid.Row="0" Margin="0,0,0,16">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                                                    <Border 
                                                        Background="{Binding ActionType, Converter={StaticResource MouseActionTypeToBackgroundConverter}}"
                                                        CornerRadius="6"
                                                        Padding="10,6"
                                                        Margin="0,0,12,0">
                                                        <StackPanel Orientation="Horizontal">
                                                            <ui:SymbolIcon Symbol="Edit24" FontSize="14" Margin="0,0,6,0"
                                                                           Foreground="{Binding ActionType, Converter={StaticResource MouseActionTypeToColorConverter}}"/>
                                                            <TextBlock 
                                                                Text="{Binding ActionTypeName}"
                                                                FontSize="13"
                                                                FontWeight="SemiBold"
                                                                Foreground="{Binding ActionType, Converter={StaticResource MouseActionTypeToColorConverter}}"/>
                                                        </StackPanel>
                                                    </Border>
                                                    <TextBlock 
                                                        Text="{Binding Description}" 
                                                        FontSize="13" 
                                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                                        VerticalAlignment="Center"/>
                                                </StackPanel>
                                                <ui:Button 
                                                    Grid.Column="1"
                                                    Command="{Binding DataContext.ViewModel.ClearSelectionCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                                    ToolTip="关闭"
                                                    Padding="6"
                                                    Appearance="Secondary">
                                                    <ui:SymbolIcon Symbol="Dismiss24" FontSize="14"/>
                                                </ui:Button>
                                            </Grid>
                                            
                                            <!-- 参数编辑区域 - 使用 WrapPanel 实现自适应布局 -->
                                            <WrapPanel Grid.Row="1" Orientation="Horizontal">
                                                
                                                <!-- 描述 -->
                                                <Border Background="{ui:ThemeResource ControlFillColorDefaultBrush}" 
                                                        CornerRadius="6" Padding="12,10" Margin="0,0,12,12" MinWidth="220">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="0,0,12,0" VerticalAlignment="Center">
                                                            <ui:SymbolIcon Symbol="Rename24" FontSize="14" Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" Margin="0,0,6,0"/>
                                                            <TextBlock Text="描述" FontSize="12" Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"/>
                                                        </StackPanel>
                                                        <ui:TextBox Grid.Column="1" Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}" 
                                                                    ClearButtonEnabled="False" MinWidth="120"/>
                                                    </Grid>
                                                </Border>
                                                
                                                <!-- 起点坐标 -->
                                                <Border Background="{ui:ThemeResource ControlFillColorDefaultBrush}" 
                                                        CornerRadius="6" Padding="12,10" Margin="0,0,12,12">
                                                    <StackPanel Orientation="Horizontal">
                                                        <ui:SymbolIcon Symbol="Location24" FontSize="14" Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="坐标" FontSize="12" Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" Margin="0,0,12,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="X" FontSize="12" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                                        <ui:NumberBox Value="{Binding X, Mode=TwoWay}" Minimum="0" Width="80" SpinButtonPlacementMode="Hidden" ClearButtonEnabled="False"/>
                                                        <TextBlock Text="Y" FontSize="12" Margin="12,0,6,0" VerticalAlignment="Center"/>
                                                        <ui:NumberBox Value="{Binding Y, Mode=TwoWay}" Minimum="0" Width="80" SpinButtonPlacementMode="Hidden" ClearButtonEnabled="False"/>
                                                    </StackPanel>
                                                </Border>
                                                
                                                <!-- 终点坐标 (拖拽) -->
                                                <Border Background="{ui:ThemeResource ControlFillColorDefaultBrush}" 
                                                        CornerRadius="6" Padding="12,10" Margin="0,0,12,12"
                                                        Visibility="{Binding ActionType, Converter={StaticResource ActionTypeToDragVisibilityConverter}}">
                                                    <StackPanel Orientation="Horizontal">
                                                        <ui:SymbolIcon Symbol="ArrowRight24" FontSize="14" Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="终点" FontSize="12" Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" Margin="0,0,12,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="X" FontSize="12" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                                        <ui:NumberBox Value="{Binding EndX, Mode=TwoWay}" Minimum="0" Width="80" SpinButtonPlacementMode="Hidden" ClearButtonEnabled="False"/>
                                                        <TextBlock Text="Y" FontSize="12" Margin="12,0,6,0" VerticalAlignment="Center"/>
                                                        <ui:NumberBox Value="{Binding EndY, Mode=TwoWay}" Minimum="0" Width="80" SpinButtonPlacementMode="Hidden" ClearButtonEnabled="False"/>
                                                    </StackPanel>
                                                </Border>
                                                
                                                <!-- 持续时间 (拖拽/长按) -->
                                                <Border Background="{ui:ThemeResource ControlFillColorDefaultBrush}" 
                                                        CornerRadius="6" Padding="12,10" Margin="0,0,12,12"
                                                        Visibility="{Binding ActionType, Converter={StaticResource ActionTypeToDurationVisibilityConverter}}">
                                                    <StackPanel Orientation="Horizontal">
                                                        <ui:SymbolIcon Symbol="Clock24" FontSize="14" Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="时长" FontSize="12" Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" Margin="0,0,12,0" VerticalAlignment="Center"/>
                                                        <ui:NumberBox Value="{Binding Duration, Mode=TwoWay}" Minimum="0" Width="80" SpinButtonPlacementMode="Hidden" ClearButtonEnabled="False"/>
                                                        <TextBlock Text="ms" FontSize="11" Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}" Margin="6,0,0,0" VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                </Border>
                                                
                                                <!-- 间隔时间 -->
                                                <Border Background="{ui:ThemeResource ControlFillColorDefaultBrush}" 
                                                        CornerRadius="6" Padding="12,10" Margin="0,0,12,12">
                                                    <StackPanel Orientation="Horizontal">
                                                        <ui:SymbolIcon Symbol="Timer24" FontSize="14" Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="间隔" FontSize="12" Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" Margin="0,0,12,0" VerticalAlignment="Center"/>
                                                        <ui:NumberBox Value="{Binding Interval, Mode=TwoWay}" Minimum="0" Width="80" SpinButtonPlacementMode="Hidden" ClearButtonEnabled="False"/>
                                                        <TextBlock Text="ms" FontSize="11" Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}" Margin="6,0,0,0" VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                </Border>
                                                
                                                <!-- 重复次数 -->
                                                <Border Background="{ui:ThemeResource ControlFillColorDefaultBrush}" 
                                                        CornerRadius="6" Padding="12,10" Margin="0,0,12,12">
                                                    <StackPanel Orientation="Horizontal">
                                                        <ui:SymbolIcon Symbol="ArrowRepeatAll24" FontSize="14" Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="次数" FontSize="12" Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" Margin="0,0,12,0" VerticalAlignment="Center"/>
                                                        <ui:NumberBox Value="{Binding Times, Mode=TwoWay}" Minimum="1" Width="80" SpinButtonPlacementMode="Hidden" ClearButtonEnabled="False"/>
                                                    </StackPanel>
                                                </Border>
                                                
                                            </WrapPanel>
                                        </Grid>
                                    </Border>
                                    
                                    <!-- 执行按钮 -->
                                    <Grid Margin="0,16,0,0">
                                        <ui:Button
                                            HorizontalAlignment="Right"
                                            Appearance="Primary"
                                            Command="{Binding ViewModel.ExecuteAllActionsCommand}"
                                            Padding="20,10">
                                            <StackPanel Orientation="Horizontal">
                                                <ui:SymbolIcon Symbol="Play24" FontSize="16"/>
                                                <TextBlock Text="执行所有操作" Margin="8,0,0,0" FontWeight="Medium"/>
                                            </StackPanel>
                                        </ui:Button>
                                    </Grid>
                                </StackPanel>
                            </Border>
                            
                            <!-- 使用提示 -->
                            <Border 
                                Margin="0,12,0,0" 
                                Padding="12"
                                Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                                CornerRadius="6"
                                BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}"
                                BorderThickness="1">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                        <ui:SymbolIcon Symbol="Info24" Margin="0,0,8,0" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                        <ui:TextBlock FontTypography="BodyStrong" Text="使用提示" />
                                    </StackPanel>
                                    <ui:TextBlock 
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="• 操作按列表顺序依次执行，执行前会有 3 秒准备时间" />
                                    <ui:TextBlock 
                                        Margin="0,4,0,0"
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="• 每个操作执行后会等待其设定的间隔时间" />
                                    <ui:TextBlock 
                                        Margin="0,4,0,0"
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="• 支持导入/导出 JSON 格式配置文件，方便保存和分享" />
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>
                <!-- 文字识别 -->
                <TabItem  MaxWidth="100">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Margin="0,0,6,0" Symbol="ScanText24" />
                            <TextBlock Text="文字识别" FontWeight="Bold" />
                        </StackPanel>
                    </TabItem.Header>
                    <StackPanel>
                        <StackPanel Margin="0,10,0,0">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <ui:TextBlock
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    FontTypography="BodyStrong"
                                    Text="选择文字识别引擎"
                                    TextWrapping="Wrap" />
                                <ui:TextBlock
                                    Grid.Row="1"
                                    Grid.Column="0"
                                    Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                    Text="选择文字识别引擎"
                                    TextWrapping="Wrap" />
                                <ComboBox
                                    Grid.Row="0"
                                    Grid.RowSpan="2"
                                    Grid.Column="1"
                                    MinWidth="120"
                                    Margin="0,0,36,0"
                                    ItemsSource="{Binding ViewModel.OCRs}"
                                    SelectedItem="{Binding ViewModel.SelectedOCR, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                            </Grid>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                            <ui:Button
                            Command="{Binding ViewModel.OCRTestCommand}"
                            Content="浏览文件并识别"
                            Margin="0,0,10,0" />
                        </StackPanel>
                        <StackPanel Margin="0,10,0,0">
                            <ui:TextBlock FontTypography="BodyStrong" Text="识别结果：" />
                            <ui:TextBox
                            Text="{Binding ViewModel.OcrResult, Mode=TwoWay}"
                            AcceptsReturn="True"
                            TextWrapping="Wrap"
                            Height="150"
                            IsReadOnly="True" Cursor="IBeam"/>
                        </StackPanel>
                    </StackPanel>
                </TabItem>
                <!-- 模板匹配 -->
                <TabItem  MaxWidth="100">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Margin="0,0,6,0" Symbol="TargetArrow24" />
                            <TextBlock Text="模板匹配" FontWeight="Bold" />
                        </StackPanel>
                    </TabItem.Header>
                    <StackPanel Margin="0,10,0,0" Orientation="Vertical">
                        <Grid Margin="0,0,0,10">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBox 
                                Grid.Row="0" 
                                Grid.Column="0" 
                                Text="{Binding ViewModel.SourceImagePath, TargetNullValue='请点击按钮选择源图→'}" 
                                VerticalAlignment="Center" 
                                Margin="4"
                                IsReadOnly="True"
                                />
                            <ui:Button Grid.Row="0" Grid.Column="1" Content="选择源图" Command="{Binding ViewModel.SelectSourceImageCommand}" Margin="4"/>

                            <TextBox 
                                Grid.Row="1" 
                                Grid.Column="0" 
                                Text="{Binding ViewModel.TemplateImagePath, TargetNullValue='请点击按钮选择模板→'}" 
                                VerticalAlignment="Center" 
                                Margin="4"
                                IsReadOnly="True"/>
                            <ui:Button Grid.Row="1" Grid.Column="1" Content="选择模板" Command="{Binding ViewModel.SelectTemplateImageCommand}" Margin="4"/>

                            <TextBox 
                                Grid.Row="2" 
                                Grid.Column="0" 
                                Text="{Binding ViewModel.MaskImagePath, TargetNullValue='请点击按钮选择遮罩→'}" 
                                VerticalAlignment="Center" 
                                Margin="4"
                                IsReadOnly="True"/>
                            <ui:Button Grid.Row="2" Grid.Column="1" Content="选择遮罩" Command="{Binding ViewModel.SelectMaskImageCommand}" Margin="4"/>

                            <StackPanel Orientation="Horizontal" Grid.Row="3" Grid.Column="0">
                                <TextBlock Text="Threshold:" FontWeight="Bold" VerticalAlignment="Center" Margin="8, 0, 8, 0"/>
                                <Slider
                                       Width="200"
                                       Margin="0"
                                       HorizontalAlignment="Left"
                                       VerticalAlignment="Center"
                                       IsSnapToTickEnabled="True"
                                       Maximum="1.00"
                                       Minimum="0.00"
                                       TickFrequency="0.01"
                                       Value="{Binding ViewModel.Threshold, Mode=TwoWay}" />
                                <TextBlock Text="{Binding ViewModel.Threshold, StringFormat={}{0:F2}, UpdateSourceTrigger=PropertyChanged}" VerticalAlignment="Center" Margin="2, 0, 0, 0"/>
                                <TextBlock Text="Mode:" FontWeight="SemiBold" VerticalAlignment="Center" Margin="16,0,8,0"/>
                                <ComboBox Width="150"
                                      ItemsSource="{Binding ViewModel.MatchModes}"
                                      SelectedItem="{Binding ViewModel.SelectedMatchMode, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            </StackPanel>

                            <ui:Button Grid.Row="3" Grid.Column="1" Content="开始匹配" Command="{Binding ViewModel.TemplateMatchCommand}" Margin="4" HorizontalAlignment="Center" Grid.ColumnSpan="1"/>
                        </Grid>

                        <Grid Margin="0,10,0,0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <ui:TextBlock Grid.Row="0" Grid.Column="0" Text="匹配区域坐标：" FontWeight="Bold" Margin="4,0,0,4"/>
                            <ui:TextBox Grid.Row="1" Grid.Column="0"
                                Text="{Binding ViewModel.MatchRectInfo, Mode=OneWay}"
                                AcceptsReturn="True"
                                TextWrapping="Wrap"
                                Height="80"
                                IsReadOnly="True"
                                Cursor="IBeam"
                                Margin="4"/>
                            <ui:Button Grid.Row="1" Grid.Column="1" 
                                Content="裁切" 
                                Command="{Binding ViewModel.CropImageCommand}" 
                                Margin="4" 
                                VerticalAlignment="Top"/>
                        </Grid>

                        <Image Source="{Binding ViewModel.ResultImage}" 
                               Margin="0,10,0,0" 
                               Stretch="Uniform" 
                               MaxHeight="500"/>
                    </StackPanel>
                </TabItem>
                <!-- 轮廓检测 -->
                <TabItem  MaxWidth="100">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Margin="0,0,6,0" Symbol="SearchSquare24" />
                            <TextBlock Text="轮廓检测" FontWeight="Bold" />
                        </StackPanel>
                    </TabItem.Header>
                    <StackPanel Margin="0,10,0,0" Orientation="Vertical" DataContext="{Binding}">
                        <StackPanel Margin="10,10,0,0" Orientation="Horizontal">
                            <Grid Cursor="">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <ui:TextBlock
                                Grid.Row="0"
                                Grid.Column="0"
                                FontTypography="BodyStrong"
                                Text="MinLen"
                                TextWrapping="Wrap" />
                                <ui:TextBlock
                                Grid.Row="1"
                                Grid.Column="0"
                                Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                Text="线段最小长度"
                                TextWrapping="Wrap" />
                                <ui:TextBox
                                Grid.Row="0"
                                Grid.RowSpan="2"
                                Grid.Column="1"
                                Width="100"
                                Margin="5,0,10,0"
                                Text="{Binding ViewModel.MinLen, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                TextWrapping="Wrap" />
                            </Grid>
                            <Grid Cursor="">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <ui:TextBlock
                                Grid.Row="0"
                                Grid.Column="0"
                                FontTypography="BodyStrong"
                                Text="MaxGap"
                                TextWrapping="Wrap" />
                                <ui:TextBlock
                                Grid.Row="1"
                                Grid.Column="0"
                                Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                Text="线段最大间隔"
                                TextWrapping="Wrap" />
                                <ui:TextBox
                                Grid.Row="0"
                                Grid.RowSpan="2"
                                Grid.Column="1"
                                Width="100"
                                Margin="5,0,10,0"
                                Text="{Binding ViewModel.MaxGap, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                TextWrapping="Wrap" />
                            </Grid>
                            <Grid Cursor="">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <ui:TextBlock
                                Grid.Row="0"
                                Grid.Column="0"
                                FontTypography="BodyStrong"
                                Text="angleThresh"
                                TextWrapping="Wrap" />
                                <ui:TextBlock
                                Grid.Row="1"
                                Grid.Column="0"
                                Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                Text="线段角度阈值"
                                TextWrapping="Wrap" />
                                <ui:TextBox
                                Grid.Row="0"
                                Grid.RowSpan="2"
                                Grid.Column="1"
                                Width="100"
                                Margin="5,0,10,0"
                                Text="{Binding ViewModel.AngleThresh, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                TextWrapping="Wrap" />
                            </Grid>

                        </StackPanel>

                        <StackPanel Margin="10,10,0,0" Orientation="Horizontal">
                            <Grid  Cursor="">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <ui:TextBlock
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    FontTypography="BodyStrong"
                                    Text="MinRadius"
                                    TextWrapping="Wrap" />
                                <ui:TextBlock
                                    Grid.Row="1"
                                    Grid.Column="0"
                                    Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                    Text="最小圆半径"
                                    TextWrapping="Wrap" />
                                <ui:NumberBox
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    Grid.RowSpan="2"
                                    Width="150"
                                    Margin="5,0,10,0"
                                    Value="{Binding ViewModel.MinRadius, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    Minimum="0"
                                    Maximum="1000"
                                    />
                            </Grid>

                            <Grid  Cursor="">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <ui:TextBlock
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    FontTypography="BodyStrong"
                                    Text="MaxRadius"
                                    TextWrapping="Wrap" />
                                <ui:TextBlock
                                    Grid.Row="1"
                                    Grid.Column="0"
                                    Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                    Text="最大圆半径"
                                    TextWrapping="Wrap" />
                                <ui:NumberBox
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    Grid.RowSpan="2"
                                    Width="150"
                                    Margin="5,0,10,0"
                                    Value="{Binding ViewModel.MaxRadius, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    Minimum="0"
                                    Maximum="1000"
                                    />
                            </Grid>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="10,10,0,10">
                            <ui:Button Content="选择图像" Command="{Binding ViewModel.SelectDetectImageCommand}" Margin="0,0,10,0" />
                            <ui:Button Content="检测线段" Command="{Binding ViewModel.DetectLinesCommand}" Margin="0,0,10,0" />
                            <ui:Button Content="检测矩形" Command="{Binding ViewModel.DetectRectangleCommand}" Margin="0,0,10,0" />
                            <ui:Button Content="检测圆形" Command="{Binding ViewModel.DetectCirclesCommand}" Margin="0,0,10,0"/>
                        </StackPanel>

                        <TextBlock Margin="10,10,0,0" Text="检测结果：" />
                        <Border BorderThickness="1" BorderBrush="Gray" CornerRadius="4" Padding="4">
                            <Image Source="{Binding ViewModel.DetectResultImage}" Stretch="Uniform" Height="Auto" MinHeight="300" />
                        </Border>
                    </StackPanel>
                </TabItem>
                <!-- 色彩过滤 -->
                <TabItem MaxWidth="100">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Margin="0,0,6,0" Symbol="Color24" />
                            <TextBlock Text="色彩过滤" FontWeight="Bold" />
                        </StackPanel>
                    </TabItem.Header>
                    <StackPanel Margin="0,10,0,0" Orientation="Vertical">
                        <Grid Margin="0,0,0,10">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBox 
                                Grid.Row="0" 
                                Grid.Column="0" 
                                Text="{Binding ViewModel.ColorFilterSourcePath, TargetNullValue='请点击按钮选择源图→'}" 
                                VerticalAlignment="Center" 
                                Margin="4"
                                IsReadOnly="True"/>
                            <ui:Button Grid.Row="0" Grid.Column="1" Content="选择源图" Command="{Binding ViewModel.SelectColorFilterSourceCommand}" Margin="4"/>

                            <TextBox 
                                Grid.Row="1" 
                                Grid.Column="0" 
                                Text="{Binding ViewModel.ColorFilterMaskPath, TargetNullValue='请点击按钮选择遮罩→'}" 
                                VerticalAlignment="Center" 
                                Margin="4"
                                IsReadOnly="True"/>
                            <ui:Button Grid.Row="1" Grid.Column="1" Content="选择遮罩" Command="{Binding ViewModel.SelectColorFilterMaskCommand}" Margin="4"/>

                            <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" Orientation="Horizontal" Margin="4">
                                <ui:TextBlock Text="目标颜色：" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <TextBox Width="120" Margin="0,0,20,0" 
                                        Text="{Binding ViewModel.TargetColorHex, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        MaxLength="6"
                                        />
                                <ui:TextBlock Text="阈值：" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <ui:NumberBox Value="{Binding ViewModel.ColorThreshold, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Minimum="0" Maximum="255" Width="200"/>
                            </StackPanel>

                            <ui:Button Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2" 
                                     Content="开始过滤" 
                                     Command="{Binding ViewModel.StartColorFilterCommand}" 
                                     Margin="4"/>

                            <TextBlock Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="2"
                                     Text="{Binding ViewModel.ColorFilterStats}"
                                     TextWrapping="Wrap"
                                     Margin="4"
                                     Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"/>
                        </Grid>

                        <Image Source="{Binding ViewModel.ColorFilterResultImage}" 
                               Margin="0,10,0,0" 
                               Stretch="Uniform" 
                               MaxHeight="500"/>
                    </StackPanel>
                </TabItem>
                
            </TabControl>
        </Border>
    </StackPanel>
</Page>
