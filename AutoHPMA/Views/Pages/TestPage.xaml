<Page
    x:Class="AutoHPMA.Views.Pages.TestPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:AutoHPMA.Views.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:pages="clr-namespace:AutoHPMA.ViewModels.Pages"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="TestPage"
    d:DataContext="{d:DesignInstance Type=pages:TestViewModel}"
    d:DesignHeight="450"
    d:DesignWidth="800"
    ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
    ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    mc:Ignorable="d">

    <StackPanel Margin="40,30,40,10" Cursor="">
        <Border
            Padding="16"
            Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
            BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
            BorderThickness="1,1,1,0"
            CornerRadius="8,8,8,8">
            <TabControl Margin="0 0 0 0" TabStripPlacement="Top">
                <!--  截屏测试  -->
                <TabItem IsSelected="True" MaxWidth="100">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Margin="0,0,6,0" Symbol="ScanCamera24" />
                            <TextBlock Text="截屏测试" FontWeight="Bold" />
                        </StackPanel>
                    </TabItem.Header>
                    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="0,10,10,10">
                        <StackPanel>
                            <!-- 截屏配置卡片 -->
                            <Border 
                                Margin="0,8,0,0" 
                                Padding="16"
                                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="6">
                                <StackPanel>
                                    <!-- 标题 -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                        <ui:SymbolIcon Margin="0,0,8,0" Symbol="Settings24" FontSize="16"/>
                                        <ui:TextBlock FontTypography="BodyStrong" Text="截屏配置" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    
                                    <!-- 截屏方式选择 -->
                                    <Grid Margin="0,0,0,12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <ui:TextBlock FontTypography="Body" Text="截屏方式" />
                                            <ui:TextBlock 
                                                Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                                Text="选择截屏 API，不同 API 对窗口捕获的兼容性不同"
                                                FontSize="12" />
                                        </StackPanel>
                                        <ComboBox
                                            Grid.Column="1"
                                            Width="200"
                                            VerticalAlignment="Center"
                                            ItemsSource="{Binding ViewModel.CaptureMethods}"
                                            SelectedItem="{Binding ViewModel.SelectedCaptureMethod, Mode=TwoWay}" />
                                    </Grid>
                                    
                                    <Separator Margin="-16,0" Opacity="0.3"/>
                                    
                                    <!-- 窗口选择 -->
                                    <Grid Margin="0,12,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <ui:TextBlock FontTypography="Body" Text="目标窗口" />
                                            <ui:TextBlock 
                                                Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                                Text="选择要进行截屏测试的目标窗口"
                                                FontSize="12" />
                                        </StackPanel>
                                        <ComboBox
                                            Grid.Column="1"
                                            Width="280"
                                            Margin="0,0,8,0"
                                            VerticalAlignment="Center"
                                            ItemsSource="{Binding ViewModel.AvailableWindows}"
                                            SelectedItem="{Binding ViewModel.SelectedWindow, Mode=TwoWay}"
                                            DisplayMemberPath="DisplayName" />
                                        <ui:Button
                                            Grid.Column="2"
                                            VerticalAlignment="Center"
                                            Command="{Binding ViewModel.RefreshWindowListCommand}"
                                            ToolTip="刷新窗口列表"
                                            Icon="{ui:SymbolIcon ArrowSync24}" />
                                    </Grid>
                                </StackPanel>
                            </Border>
                            
                            <!-- 操作按钮卡片 -->
                            <Border 
                                Margin="0,12,0,0" 
                                Padding="16"
                                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="6">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                        <ui:TextBlock FontTypography="Body" Text="实时预览" />
                                        <ui:TextBlock 
                                            Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                            Text="开启实时截屏预览窗口，测试截屏效果和性能"
                                            FontSize="12" />
                                    </StackPanel>
                                    <ui:Button
                                        Grid.Column="1"
                                        Appearance="Primary"
                                        Command="{Binding ViewModel.ScreenshotTestCommand}"
                                        Icon="{ui:SymbolIcon Play24}">
                                        <ui:Button.Content>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="开始预览" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </ui:Button.Content>
                                    </ui:Button>
                                </Grid>
                            </Border>
                            
                            <!-- 使用说明提示 -->
                            <Border 
                                Margin="0,16,0,0" 
                                Padding="12"
                                Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                                CornerRadius="6"
                                BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}"
                                BorderThickness="1">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                        <ui:SymbolIcon Symbol="Info24" Margin="0,0,8,0" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                        <ui:TextBlock FontTypography="BodyStrong" Text="使用提示" />
                                    </StackPanel>
                                    <ui:TextBlock 
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="1. 选择合适的截屏方式，推荐使用 BitBlt 或 Windows Graphics Capture 方式" />
                                    <ui:TextBlock 
                                        Margin="0,4,0,0"
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="2. 从窗口列表中选择目标游戏窗口，若未显示请点击刷新按钮" />
                                    <ui:TextBlock 
                                        Margin="0,4,0,0"
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="3. 点击开始预览按钮查看实时截屏效果，验证截图质量和帧率" />
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>
                <!--  鼠标模拟  -->
                <TabItem  MaxWidth="100">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Margin="0,0,6,0" Symbol="TapSingle24" />
                            <TextBlock Text="鼠标模拟" FontWeight="Bold" />
                        </StackPanel>
                    </TabItem.Header>
                    <StackPanel>
                        <!-- 窗口选择 -->
                        <StackPanel Margin="0,10,0,0" Orientation="Vertical">
                            <StackPanel Orientation="Horizontal">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <ui:TextBlock
                                        Grid.Row="0"
                                        Grid.Column="0"
                                        FontTypography="BodyStrong"
                                        Text="目标窗口"
                                        TextWrapping="Wrap" />
                                    <ui:TextBlock
                                        Grid.Row="1"
                                        Grid.Column="0"
                                        Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                        Text="选择要点击的窗口"
                                        TextWrapping="Wrap" />
                                </Grid>
                                <ComboBox
                                    Width="200"
                                    Margin="10,0,10,0"
                                    ItemsSource="{Binding ViewModel.AvailableWindows}"
                                    SelectedItem="{Binding ViewModel.SelectedClickWindow, Mode=TwoWay}"
                                    DisplayMemberPath="DisplayName" />
                                <ui:Button
                                    Command="{Binding ViewModel.RefreshWindowListCommand}"
                                    Content="刷新"
                                    Margin="0,0,10,0" />
                            </StackPanel>
                            
                            <!-- 子窗口选择（当父窗口有子窗口时显示） -->
                            <StackPanel Orientation="Horizontal" Margin="0,8,0,0"
                                        Visibility="{Binding ViewModel.HasChildWindows, Converter={StaticResource BoolToVisibilityConverter}}">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <ui:TextBlock
                                        Grid.Row="0"
                                        Grid.Column="0"
                                        FontTypography="BodyStrong"
                                        Text="子窗口（可选）"
                                        TextWrapping="Wrap" />
                                    <ui:TextBlock
                                        Grid.Row="1"
                                        Grid.Column="0"
                                        Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                        Text="若父窗口无法交互，可选择子窗口"
                                        TextWrapping="Wrap" />
                                </Grid>
                                <ComboBox
                                    Width="200"
                                    Margin="10,0,10,0"
                                    ItemsSource="{Binding ViewModel.AvailableChildWindows}"
                                    SelectedItem="{Binding ViewModel.SelectedClickChildWindow, Mode=TwoWay}"
                                    DisplayMemberPath="DisplayName" />
                            </StackPanel>
                            
                            <!-- 当前选择信息提示 -->
                            <StackPanel Orientation="Horizontal" Margin="0,5,0,0"
                                        Visibility="{Binding ViewModel.HasChildWindows, Converter={StaticResource BoolToVisibilityConverter}}">
                                <ui:SymbolIcon Symbol="Info16" Margin="0,0,6,0" 
                                               Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"/>
                                <ui:TextBlock
                                    Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                    Text="提示：未选择子窗口时，将直接操作父窗口"
                                    FontSize="12"
                                    VerticalAlignment="Center" />
                            </StackPanel>
                        </StackPanel>

                        <!-- 分隔线 -->
                        <Separator Margin="0,2,0,2" />

                        <!-- 点击动作表格 -->
                        <StackPanel Margin="0,2,0,0">
                            <ui:TextBlock
                                FontTypography="BodyStrong"
                                Text="点击动作列表"
                                Margin="0,0,0,10" />
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                <ui:Button
                                    Command="{Binding ViewModel.AddClickActionCommand}"
                                    Content="添加点击"
                                    Margin="0,0,10,0" />
                            </StackPanel>
                            <DataGrid
                                ItemsSource="{Binding ViewModel.ClickActions}"
                                AutoGenerateColumns="False"
                                CanUserAddRows="False"
                                Height="150"
                                Margin="0,0,0,10">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="描述" Binding="{Binding Description}" Width="120" />
                                    <DataGridTextColumn Header="X坐标" Binding="{Binding X}" Width="80" />
                                    <DataGridTextColumn Header="Y坐标" Binding="{Binding Y}" Width="80" />
                                    <DataGridTextColumn Header="间隔(ms)" Binding="{Binding Interval}" Width="80" />
                                    <DataGridTextColumn Header="次数" Binding="{Binding Times}" Width="60" />
                                    <DataGridTemplateColumn Header="操作" Width="80">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <ui:Button
                                                    Content="删除"
                                                    Command="{Binding DataContext.ViewModel.RemoveClickActionCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                    CommandParameter="{Binding}"
                                                    FontSize="12"
                                                    Padding="5,2" />
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                            <ui:Button
                                Command="{Binding ViewModel.ClickTestCommand}"
                                Content="执行点击测试"
                                Margin="0,0,10,0" />
                        </StackPanel>

                        <!-- 分隔线 -->
                        <Separator Margin="0,2,0,2" />
                        
                        <!-- 拖拽测试 -->
                        <StackPanel Margin="0,2,0,0">
                            <ui:TextBlock
                                FontTypography="BodyStrong"
                                Text="拖拽动作列表"
                                Margin="0,0,0,10" />
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                <ui:Button
                                    Command="{Binding ViewModel.AddDragActionCommand}"
                                    Content="添加拖拽"
                                    Margin="0,0,10,0" />
                            </StackPanel>
                            <DataGrid
                                ItemsSource="{Binding ViewModel.DragActions}"
                                AutoGenerateColumns="False"
                                CanUserAddRows="False"
                                Height="150"
                                Margin="0,0,0,10">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="描述" Binding="{Binding Description}" Width="120" />
                                    <DataGridTextColumn Header="起始X" Binding="{Binding StartX}" Width="80" />
                                    <DataGridTextColumn Header="起始Y" Binding="{Binding StartY}" Width="80" />
                                    <DataGridTextColumn Header="结束X" Binding="{Binding EndX}" Width="80" />
                                    <DataGridTextColumn Header="结束Y" Binding="{Binding EndY}" Width="80" />
                                    <DataGridTextColumn Header="持续时间(ms)" Binding="{Binding Duration}" Width="100" />
                                    <DataGridTemplateColumn Header="操作" Width="80">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <ui:Button
                                                    Content="删除"
                                                    Command="{Binding DataContext.ViewModel.RemoveDragActionCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                    CommandParameter="{Binding}"
                                                    FontSize="12"
                                                    Padding="5,2" />
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                            <ui:Button
                                Command="{Binding ViewModel.DragTestCommand}"
                                Content="执行拖拽测试"
                                Margin="0,0,10,0" />
                        </StackPanel>

                        <!-- 分隔线 -->
                        <Separator Margin="0,2,0,2" />
                        
                        <!-- 长按测试 -->
                        <StackPanel Margin="0,2,0,0">
                            <ui:TextBlock
                                FontTypography="BodyStrong"
                                Text="长按动作列表"
                                Margin="0,0,0,10" />
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                <ui:Button
                                    Command="{Binding ViewModel.AddLongPressActionCommand}"
                                    Content="添加长按"
                                    Margin="0,0,10,0" />
                            </StackPanel>
                            <DataGrid
                                ItemsSource="{Binding ViewModel.LongPressActions}"
                                AutoGenerateColumns="False"
                                CanUserAddRows="False"
                                Height="150"
                                Margin="0,0,0,10">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="描述" Binding="{Binding Description}" Width="120" />
                                    <DataGridTextColumn Header="X坐标" Binding="{Binding X}" Width="80" />
                                    <DataGridTextColumn Header="Y坐标" Binding="{Binding Y}" Width="80" />
                                    <DataGridTextColumn Header="持续时间(ms)" Binding="{Binding Duration}" Width="120" />
                                    <DataGridTextColumn Header="间隔(ms)" Binding="{Binding Interval}" Width="100" />
                                    <DataGridTextColumn Header="次数" Binding="{Binding Times}" Width="80" />
                                    <DataGridTemplateColumn Header="操作" Width="80">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <ui:Button
                                                    Content="删除"
                                                    Command="{Binding DataContext.ViewModel.RemoveLongPressActionCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                    CommandParameter="{Binding}"
                                                    FontSize="12"
                                                    Padding="5,2" />
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                            <ui:Button
                                Command="{Binding ViewModel.LongPressTestCommand}"
                                Content="执行长按测试"
                                Margin="0,0,10,0" />
                        </StackPanel>
                    </StackPanel>
                </TabItem>
                <!-- 文字识别 -->
                <TabItem  MaxWidth="100">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Margin="0,0,6,0" Symbol="ScanText24" />
                            <TextBlock Text="文字识别" FontWeight="Bold" />
                        </StackPanel>
                    </TabItem.Header>
                    <StackPanel>
                        <StackPanel Margin="0,10,0,0">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <ui:TextBlock
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    FontTypography="BodyStrong"
                                    Text="选择文字识别引擎"
                                    TextWrapping="Wrap" />
                                <ui:TextBlock
                                    Grid.Row="1"
                                    Grid.Column="0"
                                    Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                    Text="选择文字识别引擎"
                                    TextWrapping="Wrap" />
                                <ComboBox
                                    Grid.Row="0"
                                    Grid.RowSpan="2"
                                    Grid.Column="1"
                                    MinWidth="120"
                                    Margin="0,0,36,0"
                                    ItemsSource="{Binding ViewModel.OCRs}"
                                    SelectedItem="{Binding ViewModel.SelectedOCR, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                            </Grid>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                            <ui:Button
                            Command="{Binding ViewModel.OCRTestCommand}"
                            Content="浏览文件并识别"
                            Margin="0,0,10,0" />
                        </StackPanel>
                        <StackPanel Margin="0,10,0,0">
                            <ui:TextBlock FontTypography="BodyStrong" Text="识别结果：" />
                            <ui:TextBox
                            Text="{Binding ViewModel.OcrResult, Mode=TwoWay}"
                            AcceptsReturn="True"
                            TextWrapping="Wrap"
                            Height="150"
                            IsReadOnly="True" Cursor="IBeam"/>
                        </StackPanel>
                    </StackPanel>
                </TabItem>
                <!-- 模板匹配 -->
                <TabItem  MaxWidth="100">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Margin="0,0,6,0" Symbol="TargetArrow24" />
                            <TextBlock Text="模板匹配" FontWeight="Bold" />
                        </StackPanel>
                    </TabItem.Header>
                    <StackPanel Margin="0,10,0,0" Orientation="Vertical">
                        <Grid Margin="0,0,0,10">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBox 
                                Grid.Row="0" 
                                Grid.Column="0" 
                                Text="{Binding ViewModel.SourceImagePath, TargetNullValue='请点击按钮选择源图→'}" 
                                VerticalAlignment="Center" 
                                Margin="4"
                                IsReadOnly="True"
                                />
                            <ui:Button Grid.Row="0" Grid.Column="1" Content="选择源图" Command="{Binding ViewModel.SelectSourceImageCommand}" Margin="4"/>

                            <TextBox 
                                Grid.Row="1" 
                                Grid.Column="0" 
                                Text="{Binding ViewModel.TemplateImagePath, TargetNullValue='请点击按钮选择模板→'}" 
                                VerticalAlignment="Center" 
                                Margin="4"
                                IsReadOnly="True"/>
                            <ui:Button Grid.Row="1" Grid.Column="1" Content="选择模板" Command="{Binding ViewModel.SelectTemplateImageCommand}" Margin="4"/>

                            <TextBox 
                                Grid.Row="2" 
                                Grid.Column="0" 
                                Text="{Binding ViewModel.MaskImagePath, TargetNullValue='请点击按钮选择遮罩→'}" 
                                VerticalAlignment="Center" 
                                Margin="4"
                                IsReadOnly="True"/>
                            <ui:Button Grid.Row="2" Grid.Column="1" Content="选择遮罩" Command="{Binding ViewModel.SelectMaskImageCommand}" Margin="4"/>

                            <StackPanel Orientation="Horizontal" Grid.Row="3" Grid.Column="0">
                                <TextBlock Text="Threshold:" FontWeight="Bold" VerticalAlignment="Center" Margin="8, 0, 8, 0"/>
                                <Slider
                                       Width="200"
                                       Margin="0"
                                       HorizontalAlignment="Left"
                                       VerticalAlignment="Center"
                                       IsSnapToTickEnabled="True"
                                       Maximum="1.00"
                                       Minimum="0.00"
                                       TickFrequency="0.01"
                                       Value="{Binding ViewModel.Threshold, Mode=TwoWay}" />
                                <TextBlock Text="{Binding ViewModel.Threshold, StringFormat={}{0:F2}, UpdateSourceTrigger=PropertyChanged}" VerticalAlignment="Center" Margin="2, 0, 0, 0"/>
                                <TextBlock Text="Mode:" FontWeight="SemiBold" VerticalAlignment="Center" Margin="16,0,8,0"/>
                                <ComboBox Width="150"
                                      ItemsSource="{Binding ViewModel.MatchModes}"
                                      SelectedItem="{Binding ViewModel.SelectedMatchMode, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            </StackPanel>

                            <ui:Button Grid.Row="3" Grid.Column="1" Content="开始匹配" Command="{Binding ViewModel.TemplateMatchCommand}" Margin="4" HorizontalAlignment="Center" Grid.ColumnSpan="1"/>
                        </Grid>

                        <Grid Margin="0,10,0,0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <ui:TextBlock Grid.Row="0" Grid.Column="0" Text="匹配区域坐标：" FontWeight="Bold" Margin="4,0,0,4"/>
                            <ui:TextBox Grid.Row="1" Grid.Column="0"
                                Text="{Binding ViewModel.MatchRectInfo, Mode=OneWay}"
                                AcceptsReturn="True"
                                TextWrapping="Wrap"
                                Height="80"
                                IsReadOnly="True"
                                Cursor="IBeam"
                                Margin="4"/>
                            <ui:Button Grid.Row="1" Grid.Column="1" 
                                Content="裁切" 
                                Command="{Binding ViewModel.CropImageCommand}" 
                                Margin="4" 
                                VerticalAlignment="Top"/>
                        </Grid>

                        <Image Source="{Binding ViewModel.ResultImage}" 
                               Margin="0,10,0,0" 
                               Stretch="Uniform" 
                               MaxHeight="500"/>
                    </StackPanel>
                </TabItem>
                <!-- 轮廓检测 -->
                <TabItem  MaxWidth="100">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Margin="0,0,6,0" Symbol="SearchSquare24" />
                            <TextBlock Text="轮廓检测" FontWeight="Bold" />
                        </StackPanel>
                    </TabItem.Header>
                    <StackPanel Margin="0,10,0,0" Orientation="Vertical" DataContext="{Binding}">
                        <StackPanel Margin="10,10,0,0" Orientation="Horizontal">
                            <Grid Cursor="">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <ui:TextBlock
                                Grid.Row="0"
                                Grid.Column="0"
                                FontTypography="BodyStrong"
                                Text="MinLen"
                                TextWrapping="Wrap" />
                                <ui:TextBlock
                                Grid.Row="1"
                                Grid.Column="0"
                                Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                Text="线段最小长度"
                                TextWrapping="Wrap" />
                                <ui:TextBox
                                Grid.Row="0"
                                Grid.RowSpan="2"
                                Grid.Column="1"
                                Width="100"
                                Margin="5,0,10,0"
                                Text="{Binding ViewModel.MinLen, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                TextWrapping="Wrap" />
                            </Grid>
                            <Grid Cursor="">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <ui:TextBlock
                                Grid.Row="0"
                                Grid.Column="0"
                                FontTypography="BodyStrong"
                                Text="MaxGap"
                                TextWrapping="Wrap" />
                                <ui:TextBlock
                                Grid.Row="1"
                                Grid.Column="0"
                                Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                Text="线段最大间隔"
                                TextWrapping="Wrap" />
                                <ui:TextBox
                                Grid.Row="0"
                                Grid.RowSpan="2"
                                Grid.Column="1"
                                Width="100"
                                Margin="5,0,10,0"
                                Text="{Binding ViewModel.MaxGap, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                TextWrapping="Wrap" />
                            </Grid>
                            <Grid Cursor="">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <ui:TextBlock
                                Grid.Row="0"
                                Grid.Column="0"
                                FontTypography="BodyStrong"
                                Text="angleThresh"
                                TextWrapping="Wrap" />
                                <ui:TextBlock
                                Grid.Row="1"
                                Grid.Column="0"
                                Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                Text="线段角度阈值"
                                TextWrapping="Wrap" />
                                <ui:TextBox
                                Grid.Row="0"
                                Grid.RowSpan="2"
                                Grid.Column="1"
                                Width="100"
                                Margin="5,0,10,0"
                                Text="{Binding ViewModel.AngleThresh, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                TextWrapping="Wrap" />
                            </Grid>

                        </StackPanel>

                        <StackPanel Margin="10,10,0,0" Orientation="Horizontal">
                            <Grid  Cursor="">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <ui:TextBlock
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    FontTypography="BodyStrong"
                                    Text="MinRadius"
                                    TextWrapping="Wrap" />
                                <ui:TextBlock
                                    Grid.Row="1"
                                    Grid.Column="0"
                                    Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                    Text="最小圆半径"
                                    TextWrapping="Wrap" />
                                <ui:NumberBox
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    Grid.RowSpan="2"
                                    Width="150"
                                    Margin="5,0,10,0"
                                    Value="{Binding ViewModel.MinRadius, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    Minimum="0"
                                    Maximum="1000"
                                    />
                            </Grid>

                            <Grid  Cursor="">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <ui:TextBlock
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    FontTypography="BodyStrong"
                                    Text="MaxRadius"
                                    TextWrapping="Wrap" />
                                <ui:TextBlock
                                    Grid.Row="1"
                                    Grid.Column="0"
                                    Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                    Text="最大圆半径"
                                    TextWrapping="Wrap" />
                                <ui:NumberBox
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    Grid.RowSpan="2"
                                    Width="150"
                                    Margin="5,0,10,0"
                                    Value="{Binding ViewModel.MaxRadius, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    Minimum="0"
                                    Maximum="1000"
                                    />
                            </Grid>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="10,10,0,10">
                            <ui:Button Content="选择图像" Command="{Binding ViewModel.SelectDetectImageCommand}" Margin="0,0,10,0" />
                            <ui:Button Content="检测线段" Command="{Binding ViewModel.DetectLinesCommand}" Margin="0,0,10,0" />
                            <ui:Button Content="检测矩形" Command="{Binding ViewModel.DetectRectangleCommand}" Margin="0,0,10,0" />
                            <ui:Button Content="检测圆形" Command="{Binding ViewModel.DetectCirclesCommand}" Margin="0,0,10,0"/>
                        </StackPanel>

                        <TextBlock Margin="10,10,0,0" Text="检测结果：" />
                        <Border BorderThickness="1" BorderBrush="Gray" CornerRadius="4" Padding="4">
                            <Image Source="{Binding ViewModel.DetectResultImage}" Stretch="Uniform" Height="Auto" MinHeight="300" />
                        </Border>
                    </StackPanel>
                </TabItem>
                <!-- 色彩过滤 -->
                <TabItem MaxWidth="100">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Margin="0,0,6,0" Symbol="Color24" />
                            <TextBlock Text="色彩过滤" FontWeight="Bold" />
                        </StackPanel>
                    </TabItem.Header>
                    <StackPanel Margin="0,10,0,0" Orientation="Vertical">
                        <Grid Margin="0,0,0,10">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBox 
                                Grid.Row="0" 
                                Grid.Column="0" 
                                Text="{Binding ViewModel.ColorFilterSourcePath, TargetNullValue='请点击按钮选择源图→'}" 
                                VerticalAlignment="Center" 
                                Margin="4"
                                IsReadOnly="True"/>
                            <ui:Button Grid.Row="0" Grid.Column="1" Content="选择源图" Command="{Binding ViewModel.SelectColorFilterSourceCommand}" Margin="4"/>

                            <TextBox 
                                Grid.Row="1" 
                                Grid.Column="0" 
                                Text="{Binding ViewModel.ColorFilterMaskPath, TargetNullValue='请点击按钮选择遮罩→'}" 
                                VerticalAlignment="Center" 
                                Margin="4"
                                IsReadOnly="True"/>
                            <ui:Button Grid.Row="1" Grid.Column="1" Content="选择遮罩" Command="{Binding ViewModel.SelectColorFilterMaskCommand}" Margin="4"/>

                            <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" Orientation="Horizontal" Margin="4">
                                <ui:TextBlock Text="目标颜色：" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <TextBox Width="120" Margin="0,0,20,0" 
                                        Text="{Binding ViewModel.TargetColorHex, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        MaxLength="6"
                                        />
                                <ui:TextBlock Text="阈值：" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <ui:NumberBox Value="{Binding ViewModel.ColorThreshold, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Minimum="0" Maximum="255" Width="200"/>
                            </StackPanel>

                            <ui:Button Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2" 
                                     Content="开始过滤" 
                                     Command="{Binding ViewModel.StartColorFilterCommand}" 
                                     Margin="4"/>

                            <TextBlock Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="2"
                                     Text="{Binding ViewModel.ColorFilterStats}"
                                     TextWrapping="Wrap"
                                     Margin="4"
                                     Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"/>
                        </Grid>

                        <Image Source="{Binding ViewModel.ColorFilterResultImage}" 
                               Margin="0,10,0,0" 
                               Stretch="Uniform" 
                               MaxHeight="500"/>
                    </StackPanel>
                </TabItem>
                
            </TabControl>
        </Border>
    </StackPanel>
</Page>
