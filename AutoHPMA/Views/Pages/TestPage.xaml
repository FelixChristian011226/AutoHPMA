<Page
    x:Class="AutoHPMA.Views.Pages.TestPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:AutoHPMA.Views.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:pages="clr-namespace:AutoHPMA.ViewModels.Pages"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="TestPage"
    d:DataContext="{d:DesignInstance Type=pages:TestViewModel}"
    d:DesignHeight="450"
    d:DesignWidth="800"
    ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
    ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    mc:Ignorable="d">

    <Grid>
        <!-- 主内容区域 -->
        <StackPanel Margin="40,30,40,10" Cursor="">
        <Border
            Padding="16"
            Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
            BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
            BorderThickness="1,1,1,0"
            CornerRadius="8,8,8,8">
            <TabControl Margin="0 0 0 0" TabStripPlacement="Top">
                <!--  截屏测试  -->
                <TabItem IsSelected="True" MaxWidth="100">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Margin="0,0,6,0" Symbol="ScanCamera24" />
                            <TextBlock Text="截屏测试" FontWeight="Bold" />
                        </StackPanel>
                    </TabItem.Header>
                    <StackPanel Margin="0,10,10,10">
                            <!-- 截屏配置卡片 -->
                            <Border 
                                Margin="0,8,0,0" 
                                Padding="16"
                                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="6">
                                <StackPanel>
                                    <!-- 标题 -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                        <ui:SymbolIcon Margin="0,0,8,0" Symbol="Settings24" FontSize="16"/>
                                        <ui:TextBlock FontTypography="BodyStrong" Text="截屏配置" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    
                                    <!-- 截屏方式选择 -->
                                    <Grid Margin="0,0,0,12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <ui:TextBlock FontTypography="Body" Text="截屏方式" />
                                            <ui:TextBlock 
                                                Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                                Text="选择截屏 API，不同 API 对窗口捕获的兼容性不同"
                                                FontSize="12" />
                                        </StackPanel>
                                        <ComboBox
                                            Grid.Column="1"
                                            Width="200"
                                            VerticalAlignment="Center"
                                            ItemsSource="{Binding ViewModel.CaptureMethods}"
                                            SelectedItem="{Binding ViewModel.SelectedCaptureMethod, Mode=TwoWay}" />
                                    </Grid>
                                    
                                    <Separator Margin="-16,0" Opacity="0.3"/>
                                    
                                    <!-- 窗口选择 -->
                                    <Grid Margin="0,12,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <ui:TextBlock FontTypography="Body" Text="目标窗口" />
                                            <ui:TextBlock 
                                                Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                                Text="选择要进行截屏测试的目标窗口"
                                                FontSize="12" />
                                        </StackPanel>
                                        <ComboBox
                                            Grid.Column="1"
                                            Width="280"
                                            Margin="0,0,8,0"
                                            VerticalAlignment="Center"
                                            ItemsSource="{Binding ViewModel.AvailableWindows}"
                                            SelectedItem="{Binding ViewModel.SelectedWindow, Mode=TwoWay}"
                                            DisplayMemberPath="DisplayName" />
                                        <ui:Button
                                            Grid.Column="2"
                                            VerticalAlignment="Center"
                                            Command="{Binding ViewModel.RefreshWindowListCommand}"
                                            ToolTip="刷新窗口列表"
                                            Icon="{ui:SymbolIcon ArrowSync24}" />
                                    </Grid>
                                </StackPanel>
                            </Border>
                            
                            <!-- 操作按钮卡片 -->
                            <Border 
                                Margin="0,12,0,0" 
                                Padding="16"
                                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="6">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                        <ui:TextBlock FontTypography="Body" Text="实时预览" />
                                        <ui:TextBlock 
                                            Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                            Text="开启实时截屏预览窗口，测试截屏效果和性能"
                                            FontSize="12" />
                                    </StackPanel>
                                    <ui:Button
                                        Grid.Column="1"
                                        Appearance="Primary"
                                        Command="{Binding ViewModel.ScreenshotTestCommand}"
                                        Icon="{ui:SymbolIcon Play24}">
                                        <ui:Button.Content>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="开始预览" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </ui:Button.Content>
                                    </ui:Button>
                                </Grid>
                            </Border>
                            
                            <!-- 使用说明提示 -->
                            <Border 
                                Margin="0,16,0,0" 
                                Padding="12"
                                Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                                CornerRadius="6"
                                BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}"
                                BorderThickness="1">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                        <ui:SymbolIcon Symbol="Info24" Margin="0,0,8,0" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                        <ui:TextBlock FontTypography="BodyStrong" Text="使用提示" />
                                    </StackPanel>
                                    <ui:TextBlock 
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="1. 选择合适的截屏方式，推荐使用 BitBlt 或 Windows Graphics Capture 方式" />
                                    <ui:TextBlock 
                                        Margin="0,4,0,0"
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="2. 从窗口列表中选择目标游戏窗口，若未显示请点击刷新按钮" />
                                    <ui:TextBlock 
                                        Margin="0,4,0,0"
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="3. 点击开始预览按钮查看实时截屏效果，验证截图质量和帧率" />
                                </StackPanel>
                            </Border>
                    </StackPanel>
                </TabItem>
                <!--  鼠标模拟  -->
                <TabItem MaxWidth="100">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Margin="0,0,6,0" Symbol="TapSingle24" />
                            <TextBlock Text="鼠标模拟" FontWeight="Bold" />
                        </StackPanel>
                    </TabItem.Header>
                    <StackPanel Margin="0,10,10,10">
                            <!-- 窗口配置卡片 -->
                            <Border 
                                Margin="0,8,0,0" 
                                Padding="16"
                                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="8">
                                <StackPanel>
                                    <!-- 标题 -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                        <ui:SymbolIcon Margin="0,0,8,0" Symbol="Window24" FontSize="16" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                        <ui:TextBlock FontTypography="BodyStrong" Text="窗口配置" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    
                                    <!-- 窗口选择 -->
                                    <Grid Margin="0,0,0,12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <ui:TextBlock FontTypography="Body" Text="目标窗口" />
                                            <ui:TextBlock 
                                                Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                                Text="选择要进行鼠标操作的目标窗口"
                                                FontSize="12" />
                                        </StackPanel>
                                        <ComboBox
                                            Grid.Column="1"
                                            Width="260"
                                            Margin="0,0,8,0"
                                            VerticalAlignment="Center"
                                            ItemsSource="{Binding ViewModel.AvailableWindows}"
                                            SelectedItem="{Binding ViewModel.SelectedClickWindow, Mode=TwoWay}"
                                            DisplayMemberPath="DisplayName" />
                                        <ui:Button
                                            Grid.Column="2"
                                            VerticalAlignment="Center"
                                            Command="{Binding ViewModel.RefreshWindowListCommand}"
                                            ToolTip="刷新窗口列表"
                                            Icon="{ui:SymbolIcon ArrowSync24}" />
                                    </Grid>
                                    
                                    <!-- 子窗口选择（条件显示） -->
                                    <Grid Margin="0,0,0,0"
                                          Visibility="{Binding ViewModel.HasChildWindows, Converter={StaticResource BoolToVisibilityConverter}}">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <ui:TextBlock FontTypography="Body" Text="子窗口（可选）" />
                                            <ui:TextBlock 
                                                Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                                Text="若父窗口无法交互，可选择子窗口进行操作"
                                                FontSize="12" />
                                        </StackPanel>
                                        <ComboBox
                                            Grid.Column="1"
                                            Width="260"
                                            Margin="0,0,40,0"
                                            VerticalAlignment="Center"
                                            ItemsSource="{Binding ViewModel.AvailableChildWindows}"
                                            SelectedItem="{Binding ViewModel.SelectedClickChildWindow, Mode=TwoWay}"
                                            DisplayMemberPath="DisplayName" />
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- 操作列表卡片 -->
                            <Border 
                                Margin="0,12,0,0" 
                                Padding="16"
                                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="8">
                                <StackPanel>
                                    <!-- 标题与工具栏 -->
                                    <Grid Margin="0,0,0,12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <StackPanel Grid.Column="0" Orientation="Horizontal">
                                            <ui:SymbolIcon Margin="0,0,8,0" Symbol="List24" FontSize="16" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                            <ui:TextBlock FontTypography="BodyStrong" Text="操作列表" VerticalAlignment="Center"/>
                                        </StackPanel>
                                        
                                        <StackPanel Grid.Column="2" Orientation="Horizontal">
                                            <ui:Button 
                                                Command="{Binding ViewModel.ImportActionsCommand}"
                                                ToolTip="导入操作列表"
                                                Margin="0,0,4,0"
                                                Padding="8,6">
                                                <StackPanel Orientation="Horizontal">
                                                    <ui:SymbolIcon Symbol="ArrowDownload24" FontSize="14"/>
                                                    <TextBlock Text="导入" Margin="4,0,0,0" FontSize="12"/>
                                                </StackPanel>
                                            </ui:Button>
                                            <ui:Button 
                                                Command="{Binding ViewModel.ExportActionsCommand}"
                                                ToolTip="导出操作列表"
                                                Margin="0,0,4,0"
                                                Padding="8,6">
                                                <StackPanel Orientation="Horizontal">
                                                    <ui:SymbolIcon Symbol="ArrowUpload24" FontSize="14"/>
                                                    <TextBlock Text="导出" Margin="4,0,0,0" FontSize="12"/>
                                                </StackPanel>
                                            </ui:Button>
                                            <ui:Button 
                                                Command="{Binding ViewModel.ClearAllActionsCommand}"
                                                ToolTip="清空所有操作"
                                                Appearance="Secondary"
                                                Padding="8,6">
                                                <StackPanel Orientation="Horizontal">
                                                    <ui:SymbolIcon Symbol="Delete24" FontSize="14"/>
                                                    <TextBlock Text="清空" Margin="4,0,0,0" FontSize="12"/>
                                                </StackPanel>
                                            </ui:Button>
                                        </StackPanel>
                                    </Grid>
                                    
                                    <!-- 添加操作按钮组 -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                        <ui:Button 
                                            Command="{Binding ViewModel.AddClickActionCommand}"
                                            Margin="0,0,8,0"
                                            Padding="12,8"
                                            Background="#1F3B82F6">
                                            <StackPanel Orientation="Horizontal">
                                                <ui:SymbolIcon Symbol="CursorClick24" FontSize="14"/>
                                                <TextBlock Text="+ 点击" Margin="6,0,0,0"/>
                                            </StackPanel>
                                        </ui:Button>
                                        <ui:Button 
                                            Command="{Binding ViewModel.AddDragActionCommand}"
                                            Margin="0,0,8,0"
                                            Padding="12,8"
                                            Background="#1F22C55E">
                                            <StackPanel Orientation="Horizontal">
                                                <ui:SymbolIcon Symbol="HandDraw24" FontSize="14"/>
                                                <TextBlock Text="+ 拖拽" Margin="6,0,0,0"/>
                                            </StackPanel>
                                        </ui:Button>
                                        <ui:Button 
                                            Command="{Binding ViewModel.AddLongPressActionCommand}"
                                            Padding="12,8"
                                            Background="#1FF97316">
                                            <StackPanel Orientation="Horizontal">
                                                <ui:SymbolIcon Symbol="Timer24" FontSize="14"/>
                                                <TextBlock Text="+ 长按" Margin="6,0,0,0"/>
                                            </StackPanel>
                                        </ui:Button>
                                    </StackPanel>
                                    
                                    <!-- 操作列表 DataGrid -->
                                    <DataGrid
                                        x:Name="MouseActionsGrid"
                                        ItemsSource="{Binding ViewModel.MouseActions}"
                                        SelectedItem="{Binding ViewModel.SelectedMouseAction, Mode=TwoWay}"
                                        AutoGenerateColumns="False"
                                        CanUserAddRows="False"
                                        CanUserDeleteRows="False"
                                        CanUserReorderColumns="False"
                                        CanUserSortColumns="False"
                                        Height="200"
                                        GridLinesVisibility="Horizontal"
                                        HeadersVisibility="Column"
                                        BorderThickness="1"
                                        BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                                        IsReadOnly="True"
                                        SelectionMode="Single">
                                        <DataGrid.Columns>
                                            <!-- 类型标签 -->
                                            <DataGridTemplateColumn Header="类型" Width="70" CanUserSort="False">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <Border 
                                                            Background="{Binding ActionType, Converter={StaticResource MouseActionTypeToBackgroundConverter}}"
                                                            CornerRadius="4"
                                                            Padding="6,3"
                                                            HorizontalAlignment="Center">
                                                            <TextBlock 
                                                                Text="{Binding ActionTypeName}"
                                                                FontSize="11"
                                                                FontWeight="Medium"
                                                                Foreground="{Binding ActionType, Converter={StaticResource MouseActionTypeToColorConverter}}"/>
                                                        </Border>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            
                                            <!-- 描述 -->
                                            <DataGridTextColumn Header="描述" Binding="{Binding Description}" Width="120" CanUserSort="False"/>
                                            
                                            <!-- 参数摘要 -->
                                            <DataGridTemplateColumn Header="参数" Width="*" CanUserSort="False">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <TextBlock 
                                                            Text="{Binding ParameterSummary}"
                                                            FontFamily="Consolas"
                                                            FontSize="12"
                                                            VerticalAlignment="Center"
                                                            Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            
                                            <!-- 操作按钮 -->
                                            <DataGridTemplateColumn Header="操作" Width="100" CanUserSort="False">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                            <ui:Button 
                                                                Command="{Binding DataContext.ViewModel.MoveActionUpCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                                CommandParameter="{Binding}"
                                                                ToolTip="上移"
                                                                Padding="3"
                                                                Margin="0,0,2,0"
                                                                Appearance="Secondary">
                                                                <ui:SymbolIcon Symbol="ChevronUp24" FontSize="11"/>
                                                            </ui:Button>
                                                            <ui:Button 
                                                                Command="{Binding DataContext.ViewModel.MoveActionDownCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                                CommandParameter="{Binding}"
                                                                ToolTip="下移"
                                                                Padding="3"
                                                                Margin="0,0,2,0"
                                                                Appearance="Secondary">
                                                                <ui:SymbolIcon Symbol="ChevronDown24" FontSize="11"/>
                                                            </ui:Button>
                                                            <ui:Button 
                                                                Command="{Binding DataContext.ViewModel.RemoveMouseActionCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                                CommandParameter="{Binding}"
                                                                ToolTip="删除"
                                                                Padding="3"
                                                                Appearance="Danger">
                                                                <ui:SymbolIcon Symbol="Delete24" FontSize="11"/>
                                                            </ui:Button>
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                    
                                    <!-- 参数编辑面板（选中动作时显示） -->
                                    <Border 
                                        Margin="0,12,0,0"
                                        Padding="16"
                                        Background="{ui:ThemeResource CardBackgroundFillColorDefaultBrush}"
                                        CornerRadius="8"
                                        BorderBrush="{ui:ThemeResource CardStrokeColorDefaultBrush}"
                                        BorderThickness="1"
                                        DataContext="{Binding ViewModel.SelectedMouseAction}"
                                        Visibility="{Binding DataContext.ViewModel.SelectedMouseAction, RelativeSource={RelativeSource AncestorType=Page}, 
                                                     Converter={StaticResource NullToVisibilityConverter}}">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="*"/>
                                            </Grid.RowDefinitions>
                                            
                                            <!-- 编辑面板标题栏 -->
                                            <Grid Grid.Row="0" Margin="0,0,0,16">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                                                    <Border 
                                                        Background="{Binding ActionType, Converter={StaticResource MouseActionTypeToBackgroundConverter}}"
                                                        CornerRadius="6"
                                                        Padding="10,6"
                                                        Margin="0,0,12,0">
                                                        <StackPanel Orientation="Horizontal">
                                                            <ui:SymbolIcon Symbol="Edit24" FontSize="14" Margin="0,0,6,0"
                                                                           Foreground="{Binding ActionType, Converter={StaticResource MouseActionTypeToColorConverter}}"/>
                                                            <TextBlock 
                                                                Text="{Binding ActionTypeName}"
                                                                FontSize="13"
                                                                FontWeight="SemiBold"
                                                                Foreground="{Binding ActionType, Converter={StaticResource MouseActionTypeToColorConverter}}"/>
                                                        </StackPanel>
                                                    </Border>
                                                    <TextBlock 
                                                        Text="{Binding Description}" 
                                                        FontSize="13" 
                                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                                        VerticalAlignment="Center"/>
                                                </StackPanel>
                                                <ui:Button 
                                                    Grid.Column="1"
                                                    Command="{Binding DataContext.ViewModel.ClearSelectionCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                                    ToolTip="关闭"
                                                    Padding="6"
                                                    Appearance="Secondary">
                                                    <ui:SymbolIcon Symbol="Dismiss24" FontSize="14"/>
                                                </ui:Button>
                                            </Grid>
                                            
                                            <!-- 参数编辑区域 - 使用 WrapPanel 实现自适应布局 -->
                                            <WrapPanel Grid.Row="1" Orientation="Horizontal">
                                                
                                                <!-- 描述 -->
                                                <Border Background="{ui:ThemeResource ControlFillColorDefaultBrush}" 
                                                        CornerRadius="6" Padding="12,10" Margin="0,0,12,12" MinWidth="220">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>
                                                        <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="0,0,12,0" VerticalAlignment="Center">
                                                            <ui:SymbolIcon Symbol="Rename24" FontSize="14" Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" Margin="0,0,6,0"/>
                                                            <TextBlock Text="描述" FontSize="12" Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"/>
                                                        </StackPanel>
                                                        <ui:TextBox Grid.Column="1" Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}" 
                                                                    ClearButtonEnabled="False" MinWidth="120"/>
                                                    </Grid>
                                                </Border>
                                                
                                                <!-- 起点坐标 -->
                                                <Border Background="{ui:ThemeResource ControlFillColorDefaultBrush}" 
                                                        CornerRadius="6" Padding="12,10" Margin="0,0,12,12">
                                                    <StackPanel Orientation="Horizontal">
                                                        <ui:SymbolIcon Symbol="Location24" FontSize="14" Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="坐标" FontSize="12" Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" Margin="0,0,12,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="X" FontSize="12" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                                        <ui:NumberBox Value="{Binding X, Mode=TwoWay}" Minimum="0" Width="80" SpinButtonPlacementMode="Hidden" ClearButtonEnabled="False"/>
                                                        <TextBlock Text="Y" FontSize="12" Margin="12,0,6,0" VerticalAlignment="Center"/>
                                                        <ui:NumberBox Value="{Binding Y, Mode=TwoWay}" Minimum="0" Width="80" SpinButtonPlacementMode="Hidden" ClearButtonEnabled="False"/>
                                                    </StackPanel>
                                                </Border>
                                                
                                                <!-- 终点坐标 (拖拽) -->
                                                <Border Background="{ui:ThemeResource ControlFillColorDefaultBrush}" 
                                                        CornerRadius="6" Padding="12,10" Margin="0,0,12,12"
                                                        Visibility="{Binding ActionType, Converter={StaticResource ActionTypeToDragVisibilityConverter}}">
                                                    <StackPanel Orientation="Horizontal">
                                                        <ui:SymbolIcon Symbol="ArrowRight24" FontSize="14" Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="终点" FontSize="12" Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" Margin="0,0,12,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="X" FontSize="12" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                                        <ui:NumberBox Value="{Binding EndX, Mode=TwoWay}" Minimum="0" Width="80" SpinButtonPlacementMode="Hidden" ClearButtonEnabled="False"/>
                                                        <TextBlock Text="Y" FontSize="12" Margin="12,0,6,0" VerticalAlignment="Center"/>
                                                        <ui:NumberBox Value="{Binding EndY, Mode=TwoWay}" Minimum="0" Width="80" SpinButtonPlacementMode="Hidden" ClearButtonEnabled="False"/>
                                                    </StackPanel>
                                                </Border>
                                                
                                                <!-- 持续时间 (拖拽/长按) -->
                                                <Border Background="{ui:ThemeResource ControlFillColorDefaultBrush}" 
                                                        CornerRadius="6" Padding="12,10" Margin="0,0,12,12"
                                                        Visibility="{Binding ActionType, Converter={StaticResource ActionTypeToDurationVisibilityConverter}}">
                                                    <StackPanel Orientation="Horizontal">
                                                        <ui:SymbolIcon Symbol="Clock24" FontSize="14" Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="时长" FontSize="12" Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" Margin="0,0,12,0" VerticalAlignment="Center"/>
                                                        <ui:NumberBox Value="{Binding Duration, Mode=TwoWay}" Minimum="0" Width="80" SpinButtonPlacementMode="Hidden" ClearButtonEnabled="False"/>
                                                        <TextBlock Text="ms" FontSize="11" Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}" Margin="6,0,0,0" VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                </Border>
                                                
                                                <!-- 间隔时间 -->
                                                <Border Background="{ui:ThemeResource ControlFillColorDefaultBrush}" 
                                                        CornerRadius="6" Padding="12,10" Margin="0,0,12,12">
                                                    <StackPanel Orientation="Horizontal">
                                                        <ui:SymbolIcon Symbol="Timer24" FontSize="14" Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="间隔" FontSize="12" Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" Margin="0,0,12,0" VerticalAlignment="Center"/>
                                                        <ui:NumberBox Value="{Binding Interval, Mode=TwoWay}" Minimum="0" Width="80" SpinButtonPlacementMode="Hidden" ClearButtonEnabled="False"/>
                                                        <TextBlock Text="ms" FontSize="11" Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}" Margin="6,0,0,0" VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                </Border>
                                                
                                                <!-- 重复次数 -->
                                                <Border Background="{ui:ThemeResource ControlFillColorDefaultBrush}" 
                                                        CornerRadius="6" Padding="12,10" Margin="0,0,12,12">
                                                    <StackPanel Orientation="Horizontal">
                                                        <ui:SymbolIcon Symbol="ArrowRepeatAll24" FontSize="14" Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="次数" FontSize="12" Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" Margin="0,0,12,0" VerticalAlignment="Center"/>
                                                        <ui:NumberBox Value="{Binding Times, Mode=TwoWay}" Minimum="1" Width="80" SpinButtonPlacementMode="Hidden" ClearButtonEnabled="False"/>
                                                    </StackPanel>
                                                </Border>
                                                
                                            </WrapPanel>
                                        </Grid>
                                    </Border>
                                    
                                    <!-- 执行按钮 -->
                                    <Grid Margin="0,16,0,0">
                                        <ui:Button
                                            HorizontalAlignment="Right"
                                            Appearance="Primary"
                                            Command="{Binding ViewModel.ExecuteAllActionsCommand}"
                                            Padding="20,10">
                                            <StackPanel Orientation="Horizontal">
                                                <ui:SymbolIcon Symbol="Play24" FontSize="16"/>
                                                <TextBlock Text="执行所有操作" Margin="8,0,0,0" FontWeight="Medium"/>
                                            </StackPanel>
                                        </ui:Button>
                                    </Grid>
                                </StackPanel>
                            </Border>
                            
                            <!-- 使用提示 -->
                            <Border 
                                Margin="0,12,0,0" 
                                Padding="12"
                                Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                                CornerRadius="6"
                                BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}"
                                BorderThickness="1">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                        <ui:SymbolIcon Symbol="Info24" Margin="0,0,8,0" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                        <ui:TextBlock FontTypography="BodyStrong" Text="使用提示" />
                                    </StackPanel>
                                    <ui:TextBlock 
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="• 操作按列表顺序依次执行，执行前会有 3 秒准备时间" />
                                    <ui:TextBlock 
                                        Margin="0,4,0,0"
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="• 每个操作执行后会等待其设定的间隔时间" />
                                    <ui:TextBlock 
                                        Margin="0,4,0,0"
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="• 支持导入/导出 JSON 格式配置文件，方便保存和分享" />
                                </StackPanel>
                            </Border>
                    </StackPanel>
                </TabItem>
                <!-- 文字识别 -->
                <TabItem  MaxWidth="100">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Margin="0,0,6,0" Symbol="ScanText24" />
                            <TextBlock Text="文字识别" FontWeight="Bold" />
                        </StackPanel>
                    </TabItem.Header>
                    <StackPanel Margin="0,16,8,0">
                            <!-- 设置卡片 -->
                            <Border 
                                Padding="16"
                                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="8">
                                <StackPanel>
                                    <!-- 标题 -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                        <ui:SymbolIcon Margin="0,0,8,0" Symbol="Settings24" FontSize="16" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                        <ui:TextBlock FontTypography="BodyStrong" Text="识别设置" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    
                                    <!-- OCR引擎选择 -->
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <ui:TextBlock FontTypography="Body" Text="OCR 识别引擎"/>
                                            <ui:TextBlock 
                                                Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}" 
                                                FontSize="12"
                                                Text="选择用于识别文字的引擎"/>
                                        </StackPanel>
                                        <ComboBox
                                            Grid.Column="1"
                                            MinWidth="140"
                                            ItemsSource="{Binding ViewModel.OCRs}"
                                            SelectedItem="{Binding ViewModel.SelectedOCR, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                    </Grid>
                                    
                                    <!-- 隐藏应用窗口选项 -->
                                    <Grid Margin="0,12,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <ui:TextBlock FontTypography="Body" Text="截图时隐藏窗口"/>
                                            <ui:TextBlock 
                                                Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}" 
                                                FontSize="12"
                                                Text="启用后点击截图时自动最小化应用"/>
                                        </StackPanel>
                                        <ui:ToggleSwitch
                                            Grid.Column="1"
                                            IsChecked="{Binding ViewModel.HideWindowOnScreenshot, Mode=TwoWay}" />
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- 操作按钮卡片 -->
                            <Border 
                                Margin="0,12,0,0"
                                Padding="16"
                                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="8">
                                <StackPanel>
                                    <!-- 标题 -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                        <ui:SymbolIcon Margin="0,0,8,0" Symbol="Play24" FontSize="16" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                        <ui:TextBlock FontTypography="BodyStrong" Text="开始识别" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    
                                    <!-- 按钮组 -->
                                    <StackPanel Orientation="Horizontal">
                                        <ui:Button
                                            Command="{Binding ViewModel.OCRTestCommand}"
                                            Padding="16,10"
                                            Margin="0,0,12,0">
                                            <StackPanel Orientation="Horizontal">
                                                <ui:SymbolIcon Symbol="FolderOpen24" FontSize="16" Margin="0,0,8,0"/>
                                                <TextBlock Text="浏览文件" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </ui:Button>
                                        <ui:Button
                                            Command="{Binding ViewModel.OCRFromScreenshotCommand}"
                                            Appearance="Primary"
                                            Padding="16,10">
                                            <StackPanel Orientation="Horizontal">
                                                <ui:SymbolIcon Symbol="Screenshot24" FontSize="16" Margin="0,0,8,0"/>
                                                <TextBlock Text="截图并识别" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </ui:Button>
                                    </StackPanel>
                                </StackPanel>
                            </Border>

                            <!-- 图像预览卡片 -->
                            <Border 
                                Margin="0,12,0,0"
                                Padding="16"
                                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="8">
                                <StackPanel>
                                    <!-- 标题 -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                        <ui:SymbolIcon Margin="0,0,8,0" Symbol="Image24" FontSize="16" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                        <ui:TextBlock FontTypography="BodyStrong" Text="图像预览" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    
                                    <!-- 预览区域 -->
                                    <Border 
                                        Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                                        BorderThickness="1" 
                                        BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}" 
                                        CornerRadius="6" 
                                        Padding="8"
                                        MinHeight="120">
                                        <Grid>
                                            <!-- 占位提示 -->
                                            <StackPanel 
                                                HorizontalAlignment="Center" 
                                                VerticalAlignment="Center"
                                                Visibility="{Binding ViewModel.OcrPreviewImage, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Invert}">
                                                <ui:SymbolIcon 
                                                    Symbol="ImageOff24" 
                                                    FontSize="32" 
                                                    Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                                    HorizontalAlignment="Center"/>
                                                <TextBlock 
                                                    Text="暂无图像" 
                                                    Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                                    FontSize="12"
                                                    Margin="0,8,0,0"
                                                    HorizontalAlignment="Center"/>
                                            </StackPanel>
                                            <!-- 实际图像 -->
                                            <Image 
                                                Source="{Binding ViewModel.OcrPreviewImage}" 
                                                Stretch="Uniform" 
                                                MaxHeight="250"
                                                RenderOptions.BitmapScalingMode="HighQuality"
                                                Cursor="Hand"
                                                MouseDown="ShowZoomedImage"/>
                                        </Grid>
                                    </Border>
                                </StackPanel>
                            </Border>

                            <!-- 识别结果卡片 -->
                            <Border 
                                Margin="0,12,0,0"
                                Padding="16"
                                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="8">
                                <StackPanel>
                                    <!-- 标题 -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                        <ui:SymbolIcon Margin="0,0,8,0" Symbol="DocumentText24" FontSize="16" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                        <ui:TextBlock FontTypography="BodyStrong" Text="识别结果" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    
                                    <!-- 结果文本框 -->
                                    <ui:TextBox
                                        Text="{Binding ViewModel.OcrResult, Mode=TwoWay}"
                                        AcceptsReturn="True"
                                        TextWrapping="Wrap"
                                        MinHeight="120"
                                        MaxHeight="200"
                                        IsReadOnly="True" 
                                        Cursor="IBeam"
                                        PlaceholderText="识别结果将显示在这里..."/>
                                </StackPanel>
                            </Border>

                            <!-- 使用提示 -->
                            <Border 
                                Margin="0,12,0,16" 
                                Padding="12"
                                Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                                CornerRadius="6"
                                BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}"
                                BorderThickness="1">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                        <ui:SymbolIcon Symbol="Info24" Margin="0,0,8,0" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                        <ui:TextBlock FontTypography="BodyStrong" Text="使用提示" />
                                    </StackPanel>
                                    <ui:TextBlock 
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="• 点击「浏览文件」可选择本地图片进行识别" />
                                    <ui:TextBlock 
                                        Margin="0,4,0,0"
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="• 点击「截图并识别」会打开系统截图工具，截图后自动识别" />
                                    <ui:TextBlock 
                                        Margin="0,4,0,0"
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="• PaddleOCR 对中文识别效果更好，Tesseract 识别速度更快" />
                                </StackPanel>
                            </Border>
                    </StackPanel>
                </TabItem>
                <!-- 模板匹配 -->
                <TabItem  MaxWidth="100">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Margin="0,0,6,0" Symbol="TargetArrow24" />
                            <TextBlock Text="模板匹配" FontWeight="Bold" />
                        </StackPanel>
                    </TabItem.Header>
                    <StackPanel Margin="0,16,8,0">
                            <!-- 输入图像卡片 -->
                            <Border 
                                Padding="16"
                                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="8">
                                <StackPanel>
                                    <!-- 标题 -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                        <ui:SymbolIcon Margin="0,0,8,0" Symbol="Image24" FontSize="16" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                        <ui:TextBlock FontTypography="BodyStrong" Text="输入图像" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    
                                    <!-- 三列图像选择区 -->
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="12"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="12"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <!-- 源图像 -->
                                        <Border Grid.Column="0" 
                                                Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                                                CornerRadius="6" Padding="12">
                                            <StackPanel>
                                                <TextBlock Text="源图像" FontWeight="SemiBold" Margin="0,0,0,8"/>
                                                <Border Background="{ui:ThemeResource ControlFillColorSecondaryBrush}"
                                                        CornerRadius="4" MinHeight="100" Padding="4">
                                                    <Grid>
                                                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center"
                                                                    Visibility="{Binding ViewModel.SourceImagePreview, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Invert}">
                                                            <ui:SymbolIcon Symbol="ImageOff24" FontSize="24" Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"/>
                                                            <TextBlock Text="未选择" FontSize="11" Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                                                        </StackPanel>
                                                        <Image Source="{Binding ViewModel.SourceImagePreview}" Stretch="Uniform" MaxHeight="100" Cursor="Hand" MouseDown="ShowZoomedImage"/>
                                                    </Grid>
                                                </Border>
                                                <ui:Button Content="选择源图" Margin="0,8,0,0" HorizontalAlignment="Stretch"
                                                           Command="{Binding ViewModel.SelectSourceImageCommand}"
                                                           Icon="{ui:SymbolIcon FolderOpen24}"/>
                                            </StackPanel>
                                        </Border>
                                        
                                        <!-- 模板图像 -->
                                        <Border Grid.Column="2" 
                                                Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                                                CornerRadius="6" Padding="12">
                                            <StackPanel>
                                                <TextBlock Text="模板图像" FontWeight="SemiBold" Margin="0,0,0,8"/>
                                                <Border Background="{ui:ThemeResource ControlFillColorSecondaryBrush}"
                                                        CornerRadius="4" MinHeight="100" Padding="4">
                                                    <Grid>
                                                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center"
                                                                    Visibility="{Binding ViewModel.TemplateImagePreview, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Invert}">
                                                            <ui:SymbolIcon Symbol="ImageOff24" FontSize="24" Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"/>
                                                            <TextBlock Text="未选择" FontSize="11" Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                                                        </StackPanel>
                                                        <Image Source="{Binding ViewModel.TemplateImagePreview}" Stretch="Uniform" MaxHeight="100" Cursor="Hand" MouseDown="ShowZoomedImage"/>
                                                    </Grid>
                                                </Border>
                                                <ui:Button Content="选择模板" Margin="0,8,0,0" HorizontalAlignment="Stretch"
                                                           Command="{Binding ViewModel.SelectTemplateImageCommand}"
                                                           Icon="{ui:SymbolIcon FolderOpen24}"/>
                                            </StackPanel>
                                        </Border>
                                        
                                        <!-- 遮罩图像（可选） -->
                                        <Border Grid.Column="4" 
                                                Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                                                CornerRadius="6" Padding="12">
                                            <StackPanel>
                                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                                    <TextBlock Text="遮罩图像" FontWeight="SemiBold"/>
                                                    <TextBlock Text="（可选）" FontSize="11" Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}" Margin="4,0,0,0" VerticalAlignment="Bottom"/>
                                                </StackPanel>
                                                <Border Background="{ui:ThemeResource ControlFillColorSecondaryBrush}"
                                                        CornerRadius="4" MinHeight="100" Padding="4">
                                                    <Grid>
                                                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center"
                                                                    Visibility="{Binding ViewModel.MaskImagePreview, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Invert}">
                                                            <ui:SymbolIcon Symbol="ImageOff24" FontSize="24" Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"/>
                                                            <TextBlock Text="自动生成" FontSize="11" Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                                                        </StackPanel>
                                                        <Image Source="{Binding ViewModel.MaskImagePreview}" Stretch="Uniform" MaxHeight="100" Cursor="Hand" MouseDown="ShowZoomedImage"/>
                                                    </Grid>
                                                </Border>
                                                <Grid Margin="0,8,0,0">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="8"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <ui:Button Grid.Column="0" Content="选择" HorizontalAlignment="Stretch"
                                                               Command="{Binding ViewModel.SelectMaskImageCommand}"
                                                               Icon="{ui:SymbolIcon FolderOpen24}"/>
                                                    <ui:Button Grid.Column="2" ToolTip="清除遮罩"
                                                               Command="{Binding ViewModel.ClearMaskCommand}"
                                                               Appearance="Secondary"
                                                               Icon="{ui:SymbolIcon Delete24}"/>
                                                </Grid>
                                            </StackPanel>
                                        </Border>
                                    </Grid>
                                </StackPanel>
                            </Border>
                            
                            <!-- 匹配设置卡片 -->
                            <Border 
                                Margin="0,12,0,0"
                                Padding="16"
                                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="8">
                                <StackPanel>
                                    <!-- 标题 -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                        <ui:SymbolIcon Margin="0,0,8,0" Symbol="Settings24" FontSize="16" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                        <ui:TextBlock FontTypography="BodyStrong" Text="匹配设置" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    
                                    <!-- 设置项 -->
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="12"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        
                                        <!-- 匹配阈值 -->
                                        <Grid Grid.Row="0" Grid.Column="0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <StackPanel Grid.Column="0" VerticalAlignment="Center" Margin="0,0,16,0">
                                                <ui:TextBlock FontTypography="Body" Text="匹配阈值"/>
                                                <ui:TextBlock 
                                                    Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}" 
                                                    FontSize="11"
                                                    Text="值越高匹配越严格"/>
                                            </StackPanel>
                                            <Slider Grid.Column="1"
                                                    Minimum="0" Maximum="1" 
                                                    TickFrequency="0.01" IsSnapToTickEnabled="True"
                                                    Value="{Binding ViewModel.Threshold, Mode=TwoWay}"
                                                    VerticalAlignment="Center"/>
                                            <Border Grid.Column="2" 
                                                    Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                                                    CornerRadius="4" Padding="8,4" Margin="12,0,0,0"
                                                    VerticalAlignment="Center">
                                                <TextBlock Text="{Binding ViewModel.Threshold, StringFormat={}{0:F2}}" 
                                                           FontFamily="Consolas" FontSize="13" MinWidth="30" TextAlignment="Center"
                                                           VerticalAlignment="Center"/>
                                            </Border>
                                        </Grid>
                                        
                                        <!-- 匹配模式 -->
                                        <Grid Grid.Row="0" Grid.Column="1" Margin="24,0,0,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <StackPanel Grid.Column="0" VerticalAlignment="Center" Margin="0,0,12,0">
                                                <ui:TextBlock FontTypography="Body" Text="匹配模式"/>
                                                <ui:TextBlock 
                                                    Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}" 
                                                    FontSize="11"
                                                    Text="选择算法类型"/>
                                            </StackPanel>
                                            <ComboBox Grid.Column="1" Width="180"
                                                      ItemsSource="{Binding ViewModel.MatchModes}"
                                                      SelectedItem="{Binding ViewModel.SelectedMatchMode, Mode=TwoWay}"/>
                                        </Grid>
                                        
                                        <!-- 开始匹配按钮 -->
                                        <ui:Button Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                                                   HorizontalAlignment="Right"
                                                   Appearance="Primary"
                                                   Command="{Binding ViewModel.TemplateMatchCommand}"
                                                   Padding="20,10">
                                            <StackPanel Orientation="Horizontal">
                                                <ui:SymbolIcon Symbol="Play24" FontSize="16"/>
                                                <TextBlock Text="开始匹配" Margin="8,0,0,0" FontWeight="Medium"/>
                                            </StackPanel>
                                        </ui:Button>
                                    </Grid>
                                </StackPanel>
                            </Border>
                            
                            <!-- 匹配结果卡片 -->
                            <Border 
                                Margin="0,12,0,0"
                                Padding="16"
                                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="8">
                                <StackPanel>
                                    <!-- 标题和操作 -->
                                    <Grid Margin="0,0,0,12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" Orientation="Horizontal">
                                            <ui:SymbolIcon Margin="0,0,8,0" Symbol="TargetArrow24" FontSize="16" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                            <ui:TextBlock FontTypography="BodyStrong" Text="匹配结果" VerticalAlignment="Center"/>
                                            <Border Margin="12,0,0,0" Padding="8,4" CornerRadius="10"
                                                    Background="{ui:ThemeResource SystemAccentColorSecondaryBrush}"
                                                    Visibility="{Binding ViewModel.MatchCount, Converter={StaticResource IntToVisibilityConverter}}"
                                                    VerticalAlignment="Center">
                                                <TextBlock Foreground="White" FontSize="11" VerticalAlignment="Center">
                                                    <Run Text="找到 "/>
                                                    <Run Text="{Binding ViewModel.MatchCount, Mode=OneWay}"/>
                                                    <Run Text=" 处匹配"/>
                                                </TextBlock>
                                            </Border>
                                        </StackPanel>
                                        <ui:Button Grid.Column="1"
                                                   Content="裁切并保存"
                                                   Command="{Binding ViewModel.CropImageCommand}"
                                                   Icon="{ui:SymbolIcon Cut24}"
                                                   Visibility="{Binding ViewModel.MatchCount, Converter={StaticResource IntToVisibilityConverter}}"/>
                                    </Grid>
                                    
                                    <!-- 结果图像预览区域 -->
                                    <Border Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                                            BorderThickness="1" 
                                            BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}" 
                                            CornerRadius="6" 
                                            Padding="8"
                                            MinHeight="200">
                                        <Grid>
                                            <!-- 占位提示 -->
                                            <StackPanel 
                                                HorizontalAlignment="Center" 
                                                VerticalAlignment="Center"
                                                Visibility="{Binding ViewModel.ResultImage, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Invert}">
                                                <ui:SymbolIcon 
                                                    Symbol="ImageSearch24" 
                                                    FontSize="40" 
                                                    Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                                    HorizontalAlignment="Center"/>
                                                <TextBlock 
                                                    Text="匹配结果将显示在这里" 
                                                    Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                                    FontSize="12"
                                                    Margin="0,12,0,0"
                                                    HorizontalAlignment="Center"/>
                                            </StackPanel>
                                            <!-- 实际结果图像 -->
                                            <Image Source="{Binding ViewModel.ResultImage}" Cursor="Hand" MouseDown="ShowZoomedImage" 
                                                   Stretch="Uniform" 
                                                   MaxHeight="450"
                                                   RenderOptions.BitmapScalingMode="HighQuality"/>
                                        </Grid>
                                    </Border>
                                    
                                    <!-- 坐标详情（可折叠） -->
                                    <Expander Margin="0,12,0,0" IsExpanded="False">
                                        <Expander.Header>
                                            <StackPanel Orientation="Horizontal">
                                                <ui:SymbolIcon Symbol="TextBulletListSquare24" FontSize="14" Margin="0,0,8,0"/>
                                                <TextBlock Text="匹配坐标详情"/>
                                            </StackPanel>
                                        </Expander.Header>
                                        <ui:TextBox
                                            Text="{Binding ViewModel.MatchRectInfo, Mode=OneWay}"
                                            AcceptsReturn="True"
                                            TextWrapping="Wrap"
                                            MaxHeight="120"
                                            IsReadOnly="True"
                                            Cursor="IBeam"
                                            FontFamily="Consolas"
                                            FontSize="12"
                                            PlaceholderText="暂无匹配结果"/>
                                    </Expander>
                                </StackPanel>
                            </Border>
                            
                            <!-- 使用提示 -->
                            <Border 
                                Margin="0,12,0,16" 
                                Padding="12"
                                Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                                CornerRadius="6"
                                BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}"
                                BorderThickness="1">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                        <ui:SymbolIcon Symbol="Info24" Margin="0,0,8,0" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                        <ui:TextBlock FontTypography="BodyStrong" Text="使用提示" />
                                    </StackPanel>
                                    <ui:TextBlock 
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="• 选择源图像和模板图像后点击「开始匹配」进行模板匹配" />
                                    <ui:TextBlock 
                                        Margin="0,4,0,0"
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="• 如果模板包含透明通道（PNG），会自动生成遮罩；也可手动选择遮罩文件" />
                                    <ui:TextBlock 
                                        Margin="0,4,0,0"
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="• 推荐使用 CCoeffNormed 模式，阈值建议设置在 0.8~0.95 之间" />
                                </StackPanel>
                            </Border>
                    </StackPanel>
                </TabItem>
                <!-- 轮廓检测 -->
                <TabItem MaxWidth="100">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Margin="0,0,6,0" Symbol="SearchSquare24" />
                            <TextBlock Text="轮廓检测" FontWeight="Bold" />
                        </StackPanel>
                    </TabItem.Header>
                    <StackPanel Margin="0,10,10,10">
                            <!-- 配置卡片 -->
                            <Border 
                                Margin="0,8,0,0" 
                                Padding="16"
                                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="8">
                                <StackPanel>
                                    <!-- 标题 -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                        <ui:SymbolIcon Margin="0,0,8,0" Symbol="Settings24" FontSize="16" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                        <ui:TextBlock FontTypography="BodyStrong" Text="检测配置" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    
                                    <!-- 图像选择 -->
                                    <Grid Margin="0,0,0,12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <ui:TextBlock FontTypography="Body" Text="检测图像"/>
                                            <ui:TextBlock 
                                                Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                                Text="{Binding ViewModel.ContourImagePath, TargetNullValue='请选择要检测的图像'}"
                                                FontSize="12"
                                                TextTrimming="CharacterEllipsis" />
                                        </StackPanel>
                                        <ui:Button
                                            Grid.Column="1"
                                            VerticalAlignment="Center"
                                            Command="{Binding ViewModel.SelectContourImageCommand}"
                                            Icon="{ui:SymbolIcon FolderOpen24}">
                                            <ui:Button.Content>
                                                <TextBlock Text="选择" VerticalAlignment="Center"/>
                                            </ui:Button.Content>
                                        </ui:Button>
                                    </Grid>
                                    
                                    <Separator Margin="-16,0" Opacity="0.3"/>
                                    
                                    <!-- 二值化阈值 -->
                                    <Grid Margin="0,12,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <ui:TextBlock FontTypography="Body" Text="二值化阈值"/>
                                            <ui:TextBlock 
                                                Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                                Text="像素值大于阈值的置为白色，否则置为黑色（0-255）"
                                                FontSize="12" />
                                        </StackPanel>
                                        <ui:NumberBox
                                            Grid.Column="1"
                                            Width="120"
                                            VerticalAlignment="Center"
                                            Value="{Binding ViewModel.BinarizeThreshold, Mode=TwoWay}"
                                            Minimum="0"
                                            Maximum="255"
                                            SmallChange="1"
                                            LargeChange="10" />
                                    </Grid>
                                </StackPanel>
                            </Border>
                            
                            <!-- 操作按钮卡片 -->
                            <Border 
                                Margin="0,12,0,0" 
                                Padding="16"
                                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="8">
                                <StackPanel>
                                    <!-- 标题 -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                        <ui:SymbolIcon Margin="0,0,8,0" Symbol="Play24" FontSize="16" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                        <ui:TextBlock FontTypography="BodyStrong" Text="开始检测" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    
                                    <StackPanel Orientation="Horizontal">
                                        <ui:Button
                                            Command="{Binding ViewModel.TestBinarizeCommand}"
                                            Margin="0,0,12,0"
                                            Padding="16,10">
                                            <StackPanel Orientation="Horizontal">
                                                <ui:SymbolIcon Symbol="ImageEdit24" FontSize="16" Margin="0,0,8,0"/>
                                                <TextBlock Text="二值化" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </ui:Button>
                                        <ui:Button
                                            Command="{Binding ViewModel.TestDetectRectangleCommand}"
                                            Appearance="Primary"
                                            Padding="16,10">
                                            <StackPanel Orientation="Horizontal">
                                                <ui:SymbolIcon Symbol="SelectAllOn24" FontSize="16" Margin="0,0,8,0"/>
                                                <TextBlock Text="矩形检测" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </ui:Button>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                            
                            <!-- 图像预览卡片 -->
                            <Border 
                                Margin="0,12,0,0" 
                                Padding="16"
                                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="8">
                                <StackPanel>
                                    <!-- 标题 -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                        <ui:SymbolIcon Margin="0,0,8,0" Symbol="Image24" FontSize="16" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                        <ui:TextBlock FontTypography="BodyStrong" Text="检测结果" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    
                                    <!-- 检测结果信息 -->
                                    <Border 
                                        Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                                        CornerRadius="6"
                                        Padding="12"
                                        Margin="0,0,0,12"
                                        Visibility="{Binding ViewModel.DetectedRectInfo, Converter={StaticResource NullToVisibilityConverter}}">
                                        <StackPanel Orientation="Horizontal">
                                            <ui:SymbolIcon Symbol="Info24" Margin="0,0,8,0" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                            <ui:TextBlock Text="{Binding ViewModel.DetectedRectInfo}" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- 图像预览网格 -->
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <!-- 原图 -->
                                        <StackPanel Grid.Column="0" Margin="0,0,6,0">
                                            <ui:TextBlock Text="原图" FontSize="12" Margin="0,0,0,6" HorizontalAlignment="Center"/>
                                            <Border 
                                                Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                                                BorderThickness="1" 
                                                BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}" 
                                                CornerRadius="6"
                                                MinHeight="150">
                                                <Image Source="{Binding ViewModel.ContourImagePreview}" Stretch="Uniform" MaxHeight="200" Cursor="Hand" MouseDown="ShowZoomedImage"/>
                                            </Border>
                                        </StackPanel>
                                        
                                        <!-- 二值化结果 -->
                                        <StackPanel Grid.Column="1" Margin="3,0">
                                            <ui:TextBlock Text="二值化" FontSize="12" Margin="0,0,0,6" HorizontalAlignment="Center"/>
                                            <Border 
                                                Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                                                BorderThickness="1" 
                                                BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}" 
                                                CornerRadius="6"
                                                MinHeight="150">
                                                <Image Source="{Binding ViewModel.BinarizedImagePreview}" Stretch="Uniform" MaxHeight="200" Cursor="Hand" MouseDown="ShowZoomedImage"/>
                                            </Border>
                                        </StackPanel>
                                        
                                        <!-- 检测结果 -->
                                        <StackPanel Grid.Column="2" Margin="6,0,0,0">
                                            <ui:TextBlock Text="检测结果" FontSize="12" Margin="0,0,0,6" HorizontalAlignment="Center"/>
                                            <Border 
                                                Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                                                BorderThickness="1" 
                                                BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}" 
                                                CornerRadius="6"
                                                MinHeight="150">
                                                <Image Source="{Binding ViewModel.ContourResultImage}" Stretch="Uniform" MaxHeight="200" Cursor="Hand" MouseDown="ShowZoomedImage"/>
                                            </Border>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>
                            
                            <!-- 使用提示 -->
                            <Border 
                                Margin="0,12,0,0" 
                                Padding="12"
                                Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                                CornerRadius="6"
                                BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}"
                                BorderThickness="1">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                        <ui:SymbolIcon Symbol="Info24" Margin="0,0,8,0" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                        <ui:TextBlock FontTypography="BodyStrong" Text="使用提示" />
                                    </StackPanel>
                                    <ui:TextBlock 
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="• 此功能用于测试 Binarize（二值化）和 DetectApproxRectangle（矩形检测）方法" />
                                    <ui:TextBlock 
                                        Margin="0,4,0,0"
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="• 调整二值化阈值可以影响检测效果，较高的阈值会使更多像素变为黑色" />
                                    <ui:TextBlock 
                                        Margin="0,4,0,0"
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="• 矩形检测会自动对图像进行二值化处理，然后检测最大的近似矩形区域" />
                                </StackPanel>
                            </Border>
                    </StackPanel>
                </TabItem>
                <!-- 色彩过滤 -->
                <TabItem MaxWidth="100">
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Margin="0,0,6,0" Symbol="Color24" />
                            <TextBlock Text="色彩过滤" FontWeight="Bold" />
                        </StackPanel>
                    </TabItem.Header>
                    <StackPanel Margin="0,16,8,0">
                            <!-- 输入图像卡片 -->
                            <Border 
                                Padding="16"
                                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="8">
                                <StackPanel>
                                    <!-- 标题 -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                        <ui:SymbolIcon Margin="0,0,8,0" Symbol="Image24" FontSize="16" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                        <ui:TextBlock FontTypography="BodyStrong" Text="输入图像" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    
                                    <!-- 两列图像选择区 -->
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="12"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <!-- 源图像 -->
                                        <Border Grid.Column="0" 
                                                Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                                                CornerRadius="6" Padding="12">
                                            <StackPanel>
                                                <TextBlock Text="源图像" FontWeight="SemiBold" Margin="0,0,0,8"/>
                                                <Border Background="{ui:ThemeResource ControlFillColorSecondaryBrush}"
                                                        CornerRadius="4" MinHeight="100" Padding="4">
                                                    <Grid>
                                                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center"
                                                                    Visibility="{Binding ViewModel.ColorFilterSourcePreview, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Invert}">
                                                            <ui:SymbolIcon Symbol="ImageOff24" FontSize="24" Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"/>
                                                            <TextBlock Text="未选择" FontSize="11" Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                                                        </StackPanel>
                                                        <Image Source="{Binding ViewModel.ColorFilterSourcePreview}" Stretch="Uniform" MaxHeight="100" Cursor="Hand" MouseDown="ShowZoomedImage"/>
                                                    </Grid>
                                                </Border>
                                                <ui:Button Content="选择源图" Margin="0,8,0,0" HorizontalAlignment="Stretch"
                                                           Command="{Binding ViewModel.SelectColorFilterSourceCommand}"
                                                           Icon="{ui:SymbolIcon FolderOpen24}"/>
                                            </StackPanel>
                                        </Border>
                                        
                                        <!-- 遮罩图像（可选） -->
                                        <Border Grid.Column="2" 
                                                Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                                                CornerRadius="6" Padding="12">
                                            <StackPanel>
                                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                                    <TextBlock Text="遮罩图像" FontWeight="SemiBold"/>
                                                    <TextBlock Text="（可选）" FontSize="11" Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}" Margin="4,0,0,0" VerticalAlignment="Bottom"/>
                                                </StackPanel>
                                                <Border Background="{ui:ThemeResource ControlFillColorSecondaryBrush}"
                                                        CornerRadius="4" MinHeight="100" Padding="4">
                                                    <Grid>
                                                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center"
                                                                    Visibility="{Binding ViewModel.ColorFilterMaskPreview, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Invert}">
                                                            <ui:SymbolIcon Symbol="ImageOff24" FontSize="24" Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"/>
                                                            <TextBlock Text="未选择" FontSize="11" Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                                                        </StackPanel>
                                                        <Image Source="{Binding ViewModel.ColorFilterMaskPreview}" Stretch="Uniform" MaxHeight="100" Cursor="Hand" MouseDown="ShowZoomedImage"/>
                                                    </Grid>
                                                </Border>
                                                <Grid Margin="0,8,0,0">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="8"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <ui:Button Grid.Column="0" Content="选择" HorizontalAlignment="Stretch"
                                                               Command="{Binding ViewModel.SelectColorFilterMaskCommand}"
                                                               Icon="{ui:SymbolIcon FolderOpen24}"/>
                                                    <ui:Button Grid.Column="2" ToolTip="清除遮罩"
                                                               Command="{Binding ViewModel.ClearColorFilterMaskCommand}"
                                                               Appearance="Secondary"
                                                               Icon="{ui:SymbolIcon Delete24}"/>
                                                </Grid>
                                            </StackPanel>
                                        </Border>
                                    </Grid>
                                </StackPanel>
                            </Border>
                            
                            <!-- 参数与结果卡片（合并） -->
                            <Border 
                                Margin="0,12,0,0"
                                Padding="16"
                                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="8">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" MinWidth="280"/>
                                        <ColumnDefinition Width="16"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- 左侧：参数设置 -->
                                    <StackPanel Grid.Column="0">
                                        <!-- 标题 -->
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                            <ui:SymbolIcon Margin="0,0,8,0" Symbol="Settings24" FontSize="16" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                            <ui:TextBlock FontTypography="BodyStrong" Text="过滤参数" VerticalAlignment="Center"/>
                                        </StackPanel>
                                        
                                        <!-- 目标颜色 -->
                                        <Grid Margin="0,0,0,8">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="70"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <ui:TextBlock Grid.Column="0" Text="目标颜色" VerticalAlignment="Center"/>
                                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                                <Border Width="28" Height="28" CornerRadius="4" BorderThickness="1"
                                                        BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}"
                                                        Cursor="Hand" MouseDown="ColorPreview_MouseDown" ToolTip="点击打开调色盘">
                                                    <Border.Background>
                                                        <SolidColorBrush Color="{Binding ViewModel.TargetColorHex, Converter={StaticResource HexToColorConverter}}"/>
                                                    </Border.Background>
                                                </Border>
                                                <TextBlock Text="#" FontFamily="Consolas" FontSize="13" VerticalAlignment="Center" 
                                                           Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" Margin="8,0,2,0"/>
                                                <ui:TextBox Width="80" MaxLength="6" FontFamily="Consolas" FontSize="13"
                                                            Text="{Binding ViewModel.TargetColorHex, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                            </StackPanel>
                                        </Grid>
                                        
                                        <!-- 颜色空间 -->
                                        <Grid Margin="0,0,0,8">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="70"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <ui:TextBlock Grid.Column="0" Text="颜色空间" VerticalAlignment="Center"/>
                                            <ComboBox Grid.Column="1" 
                                                      ItemsSource="{Binding ViewModel.ColorSpaceOptions}"
                                                      SelectedItem="{Binding ViewModel.SelectedColorSpace, Mode=TwoWay}"
                                                      Width="100" HorizontalAlignment="Left"/>
                                        </Grid>
                                        
                                        <!-- 分隔线 -->
                                        <Border Height="1" Background="{ui:ThemeResource ControlStrokeColorDefaultBrush}" Margin="0,4,0,12"/>
                                        
                                        <!-- 颜色空间参数描述 -->
                                        <ui:TextBlock FontTypography="Caption" Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}" Margin="0,0,0,6">
                                            <ui:TextBlock.Style>
                                                <Style TargetType="ui:TextBlock">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding ViewModel.SelectedColorSpace}" Value="LAB">
                                                            <Setter Property="Text" Value="LAB 通道容差 (更接近人眼感知)"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding ViewModel.SelectedColorSpace}" Value="HSV">
                                                            <Setter Property="Text" Value="HSV 通道容差 (按色相分离)"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </ui:TextBlock.Style>
                                        </ui:TextBlock>
                                        
                                        <!-- 三个容差参数：竖直滑块布局 -->
                                        <Grid Margin="0,0,0,12" MinHeight="130">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="12"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="12"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <!-- 色相/b* -->
                                            <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                                <ui:TextBlock FontSize="11" HorizontalAlignment="Center" Margin="0,0,0,6">
                                                    <ui:TextBlock.Style>
                                                        <Style TargetType="ui:TextBlock">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding ViewModel.SelectedColorSpace}" Value="LAB">
                                                                    <Setter Property="Text" Value="b* (黄蓝)"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding ViewModel.SelectedColorSpace}" Value="HSV">
                                                                    <Setter Property="Text" Value="H (色相)"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </ui:TextBlock.Style>
                                                </ui:TextBlock>
                                                <Slider Orientation="Vertical" Height="70"
                                                        Minimum="0" Maximum="90" 
                                                        TickFrequency="5" IsSnapToTickEnabled="True"
                                                        Value="{Binding ViewModel.ColorThreshold, Mode=TwoWay}"
                                                        HorizontalAlignment="Center"/>
                                                <TextBlock Text="{Binding ViewModel.ColorThreshold}" 
                                                           FontFamily="Consolas" FontSize="12" 
                                                           HorizontalAlignment="Center" Margin="0,4,0,0"/>
                                            </StackPanel>
                                            
                                            <!-- 饱和度/a* -->
                                            <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                                <ui:TextBlock FontSize="11" HorizontalAlignment="Center" Margin="0,0,0,6">
                                                    <ui:TextBlock.Style>
                                                        <Style TargetType="ui:TextBlock">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding ViewModel.SelectedColorSpace}" Value="LAB">
                                                                    <Setter Property="Text" Value="a* (红绿)"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding ViewModel.SelectedColorSpace}" Value="HSV">
                                                                    <Setter Property="Text" Value="S (饱和度)"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </ui:TextBlock.Style>
                                                </ui:TextBlock>
                                                <Slider Orientation="Vertical" Height="70"
                                                        Minimum="0" Maximum="255" 
                                                        TickFrequency="10" IsSnapToTickEnabled="True"
                                                        Value="{Binding ViewModel.SaturationTolerance, Mode=TwoWay}"
                                                        HorizontalAlignment="Center"/>
                                                <TextBlock Text="{Binding ViewModel.SaturationTolerance}" 
                                                           FontFamily="Consolas" FontSize="12" 
                                                           HorizontalAlignment="Center" Margin="0,4,0,0"/>
                                            </StackPanel>
                                            
                                            <!-- 明度/L -->
                                            <StackPanel Grid.Column="4" HorizontalAlignment="Center">
                                                <ui:TextBlock FontSize="11" HorizontalAlignment="Center" Margin="0,0,0,6">
                                                    <ui:TextBlock.Style>
                                                        <Style TargetType="ui:TextBlock">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding ViewModel.SelectedColorSpace}" Value="LAB">
                                                                    <Setter Property="Text" Value="L (明度)"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding ViewModel.SelectedColorSpace}" Value="HSV">
                                                                    <Setter Property="Text" Value="V (明度)"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </ui:TextBlock.Style>
                                                </ui:TextBlock>
                                                <Slider Orientation="Vertical" Height="70"
                                                        Minimum="0" Maximum="255" 
                                                        TickFrequency="10" IsSnapToTickEnabled="True"
                                                        Value="{Binding ViewModel.ValueTolerance, Mode=TwoWay}"
                                                        HorizontalAlignment="Center"/>
                                                <TextBlock Text="{Binding ViewModel.ValueTolerance}" 
                                                           FontFamily="Consolas" FontSize="12" 
                                                           HorizontalAlignment="Center" Margin="0,4,0,0"/>
                                            </StackPanel>
                                        </Grid>
                                        
                                        <!-- 开始过滤按钮 -->
                                        <ui:Button HorizontalAlignment="Stretch"
                                                   Appearance="Primary"
                                                   Command="{Binding ViewModel.StartColorFilterCommand}"
                                                   Padding="12,8">
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                <ui:SymbolIcon Symbol="Play24" FontSize="14"/>
                                                <TextBlock Text="开始过滤" Margin="6,0,0,0"/>
                                            </StackPanel>
                                        </ui:Button>
                                    </StackPanel>
                                    
                                    <!-- 分隔线 -->
                                    <Border Grid.Column="1" Width="1" Background="{ui:ThemeResource ControlStrokeColorDefaultBrush}"/>
                                    
                                    <!-- 右侧：结果预览 -->
                                    <StackPanel Grid.Column="2">
                                        <!-- 标题 -->
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                            <ui:SymbolIcon Margin="0,0,8,0" Symbol="Color24" FontSize="16" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                            <ui:TextBlock FontTypography="BodyStrong" Text="过滤结果" VerticalAlignment="Center"/>
                                        </StackPanel>
                                        
                                        <!-- 结果图像预览 -->
                                        <Border Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                                                BorderThickness="1" 
                                                BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}" 
                                                CornerRadius="6" 
                                                Padding="8"
                                                MinHeight="160">
                                            <Grid>
                                                <!-- 占位提示 -->
                                                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center"
                                                            Visibility="{Binding ViewModel.ColorFilterResultImage, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Invert}">
                                                    <ui:SymbolIcon Symbol="ColorBackground24" FontSize="32" 
                                                                   Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                                                   HorizontalAlignment="Center"/>
                                                    <TextBlock Text="过滤结果" 
                                                               Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                                               FontSize="11" Margin="0,8,0,0" HorizontalAlignment="Center"/>
                                                </StackPanel>
                                                <!-- 实际结果图像 -->
                                                <Image Source="{Binding ViewModel.ColorFilterResultImage}" Cursor="Hand" MouseDown="ShowZoomedImage" 
                                                       Stretch="Uniform" MaxHeight="300"
                                                       RenderOptions.BitmapScalingMode="HighQuality"/>
                                            </Grid>
                                        </Border>
                                        
                                        <!-- 统计信息（图像下方） -->
                                        <Border Margin="0,8,0,0" Padding="10,6" CornerRadius="4"
                                                Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                                                Visibility="{Binding ViewModel.ColorFilterStats, Converter={StaticResource NullToVisibilityConverter}}"
                                                HorizontalAlignment="Stretch">
                                            <TextBlock Text="{Binding ViewModel.ColorFilterStats}" 
                                                       FontSize="11" FontFamily="Consolas"
                                                       Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                                       HorizontalAlignment="Center"/>
                                        </Border>
                                    </StackPanel>
                                </Grid>
                            </Border>
                            
                            <!-- 使用提示 -->
                            <Border 
                                Margin="0,12,0,16" 
                                Padding="12"
                                Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                                CornerRadius="6"
                                BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}"
                                BorderThickness="1">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                        <ui:SymbolIcon Symbol="Info24" Margin="0,0,8,0" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                        <ui:TextBlock FontTypography="BodyStrong" Text="使用提示" />
                                    </StackPanel>
                                    <ui:TextBlock 
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="• 输入 6 位十六进制颜色值（如 ff0000 表示红色）" />
                                    <ui:TextBlock 
                                        Margin="0,4,0,0"
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="• 遮罩图像用于限定过滤区域，白色区域将被检测" />
                                    <ui:TextBlock 
                                        Margin="0,4,0,0"
                                        Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}"
                                        TextWrapping="Wrap"
                                        FontSize="12"
                                        Text="• 阈值越大，匹配的颜色范围越广；建议从 15~30 开始调整" />
                                </StackPanel>
                            </Border>
                    </StackPanel>
                </TabItem>
                
            </TabControl>
        </Border>
    </StackPanel>
        
        <!-- 图像放大查看弹窗 -->
        <Popup x:Name="ImageViewerPopup" 
               Placement="Center"
               PlacementTarget="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
               StaysOpen="True"
               AllowsTransparency="True"
               PopupAnimation="None">
            <Grid Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Window}}"
                  Height="{Binding ActualHeight, RelativeSource={RelativeSource AncestorType=Window}}"
                  MouseDown="ImageViewerOverlay_MouseDown"
                  Cursor="Hand">
                <!-- 半透明遮罩背景 -->
                <Rectangle Fill="#E0000000"/>
                
                <!-- 居中的图像容器 -->
                <Border 
                    HorizontalAlignment="Center" 
                    VerticalAlignment="Center"
                    Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="12"
                    Padding="16"
                    MaxWidth="900"
                    MaxHeight="700">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <!-- 标题栏 -->
                        <Grid Grid.Row="0" Margin="0,0,0,12">
                            <StackPanel Orientation="Horizontal">
                                <ui:SymbolIcon Symbol="ZoomIn24" Margin="0,0,8,0" Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                <ui:TextBlock Text="图像预览" FontTypography="BodyStrong"/>
                            </StackPanel>
                            <ui:TextBlock 
                                HorizontalAlignment="Right" 
                                Text="点击任意位置关闭" 
                                FontSize="12" 
                                Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"/>
                        </Grid>
                        
                        <!-- 放大的图像 -->
                        <Border 
                            Grid.Row="1"
                            Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                            BorderThickness="1"
                            BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}"
                            CornerRadius="8">
                            <Image x:Name="ZoomedImage" 
                                   Stretch="Uniform" 
                                   RenderOptions.BitmapScalingMode="HighQuality"/>
                        </Border>
                    </Grid>
                </Border>
            </Grid>
        </Popup>
    </Grid>
</Page>

