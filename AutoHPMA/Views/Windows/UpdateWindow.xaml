<ui:FluentWindow x:Class="AutoHPMA.Views.Windows.UpdateWindow"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                 xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
                 mc:Ignorable="d"
                 Title="发现新版本"
                 Height="720"
                 Width="800"
                 MinHeight="550"
                 MinWidth="600"
                 WindowStartupLocation="CenterOwner"
                 ExtendsContentIntoTitleBar="True"
                 WindowBackdropType="Mica">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- 标题栏 -->
        <ui:TitleBar Grid.Row="0" Title="{Binding Title, RelativeSource={RelativeSource AncestorType=Window}}" />

        <!-- 主要内容 -->
        <ScrollViewer Grid.Row="1" Margin="24,12,24,12" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!-- 版本信息 -->
                <ui:CardControl Margin="0,0,0,16">
                    <ui:CardControl.Icon>
                        <ui:SymbolIcon Symbol="ArrowCircleUp24" />
                    </ui:CardControl.Icon>
                    <ui:CardControl.Header>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <ui:TextBlock Grid.Row="0"
                                          FontTypography="BodyStrong"
                                          Text="{Binding VersionTitle}"
                                          TextWrapping="Wrap" />
                            <ui:TextBlock Grid.Row="1"
                                          Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                          Text="{Binding PublishDate}"
                                          TextWrapping="Wrap" />
                        </Grid>
                    </ui:CardControl.Header>
                </ui:CardControl>

                <!-- 更新内容 -->
                <Border Background="{ui:ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ui:ThemeResource CardStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Margin="0,0,0,16"
                        Padding="20">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        
                        <!-- 标题区域 -->
                        <StackPanel Grid.Row="0" 
                                    Orientation="Horizontal" 
                                    Margin="0,0,0,12">
                            <ui:SymbolIcon Symbol="DocumentText24" 
                                           FontSize="20"
                                           Foreground="{ui:ThemeResource AccentTextFillColorPrimaryBrush}"
                                           VerticalAlignment="Center"
                                           Margin="0,0,12,0" />
                            <ui:TextBlock FontTypography="BodyStrong"
                                          FontSize="16"
                                          Text="更新内容"
                                          VerticalAlignment="Center"
                                          TextWrapping="Wrap" />
                        </StackPanel>
                        
                        <!-- 分隔线 -->
                        <Border Grid.Row="1"
                                Height="1"
                                Background="{ui:ThemeResource DividerStrokeColorDefaultBrush}"
                                Margin="0,0,0,16" />
                        
                        <!-- 内容区域 -->
                        <Border Grid.Row="2"
                                Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                                BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="6">
                            <wv2:WebView2
                                x:Name="ReleaseNotesWebBrowser"
                                Height="200"
                                Margin="1" />
                        </Border>
                    </Grid>
                </Border>

                <!-- 更新选项 -->
                <ui:CardControl Margin="0,0,0,16">
                    <ui:CardControl.Icon>
                        <ui:SymbolIcon Symbol="ArrowDownload24" />
                    </ui:CardControl.Icon>
                    <ui:CardControl.Header>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <ui:TextBlock Grid.Row="0"
                                          FontTypography="BodyStrong"
                                          Text="自动更新"
                                          TextWrapping="Wrap" />
                            <ui:TextBlock Grid.Row="1"
                                          Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                          Text="使用内置更新程序自动下载并安装更新"
                                          TextWrapping="Wrap" />
                        </Grid>
                    </ui:CardControl.Header>
                    <StackPanel Orientation="Horizontal">
                        <ui:Button Name="UpdateButton"
                                   Appearance="Success"
                                   Icon="{ui:SymbolIcon ArrowDownload24}"
                                   Content="立即更新"
                                   Click="UpdateButton_Click" />
                    </StackPanel>
                </ui:CardControl>

                <!-- 手动下载选项 -->
                <ui:CardControl>
                    <ui:CardControl.Icon>
                        <ui:SymbolIcon Symbol="Globe24" />
                    </ui:CardControl.Icon>
                    <ui:CardControl.Header>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <ui:TextBlock Grid.Row="0"
                                          FontTypography="BodyStrong"
                                          Text="手动下载"
                                          TextWrapping="Wrap" />
                            <ui:TextBlock Grid.Row="1"
                                          Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}"
                                          Text="前往GitHub下载页面手动下载更新"
                                          TextWrapping="Wrap" />
                        </Grid>
                    </ui:CardControl.Header>
                    <StackPanel Orientation="Horizontal">
                        <ui:Button Name="DownloadButton"
                                   Icon="{ui:SymbolIcon Globe24}"
                                   Content="前往下载"
                                   Click="DownloadButton_Click" />
                    </StackPanel>
                </ui:CardControl>
            </StackPanel>
        </ScrollViewer>

        <!-- 底部按钮 -->
        <Border Grid.Row="2" 
                Background="{ui:ThemeResource ControlFillColorDefaultBrush}"
                BorderBrush="{ui:ThemeResource ControlStrokeColorDefaultBrush}"
                BorderThickness="0,1,0,0">
            <StackPanel Orientation="Horizontal" 
                        HorizontalAlignment="Right" 
                        Margin="24,12">
                <ui:Button Name="CancelButton"
                           Content="稍后提醒"
                           Margin="0,0,8,0"
                           Click="CancelButton_Click" />
            </StackPanel>
        </Border>
    </Grid>
</ui:FluentWindow>